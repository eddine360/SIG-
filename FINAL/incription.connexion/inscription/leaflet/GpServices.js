!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("xmldom"),require("request")):"function"==typeof define&&define.amd?define("Gp",["require","require"],e):"object"==typeof exports?exports.Gp=e(require("xmldom"),require("request")):t.Gp=e(t[void 0],t[void 0])}("undefined"!=typeof self?self:this,function(t,e){return function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=43)}([function(t,e,r){"use strict";var o=r(47),n=(r.n(o),{getLogger:function(t){o.disableAll();var e=t||"default";return o.getLogger(e)}});e.a=n},function(t,e,r){"use strict";var o={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(t,e){if(0===Object.keys(arguments).length)return"Message indefined !";var r=Array.prototype.slice.call(arguments),o=r.shift(),n=r,s=this[o];try{s=Array.isArray(n)&&n.length>0?s.replace("%var%",n.join(" - ")):s.replace("%var%","%var% (not specified)")}catch(t){}return s}};e.a=o},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("ErrorService constructor cannot be called as a function.");var e=t;"string"==typeof t||t instanceof String?(this.message=t,this.status=-1,this.type=o.TYPE_UNKERR):(this.message=e.message||"undefined!?",this.type=e.type,this.status=e.status||-1),this.name="ErrorService",this.stack=(new Error).stack}o.TYPE_SRVERR="SERVICE_ERROR",o.TYPE_USEERR="USAGE_ERROR",o.TYPE_UNKERR="UNKNOWN_ERROR",o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),e.a=o},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(i.a.getMessage("CLASS_CONSTRUCTOR"));this.logger=n.a.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(t){console.log("onSuccess - la reponse est la suivante : ",t)},onFailure:function(t){200!==t.status&&t.status?console.log("onFailure - Erreur (",t.status,") : ",t.message):console.log("onFailure : ",t.message)}};for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(i.a.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(t){console.log("onSuccess - la réponse brute du service est la suivante : ",t)}),!!(null===this.options.onSuccess||"function"!=typeof this.options.onSuccess))throw new Error(i.a.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){c.a.ssl=this.options.ssl;var r=c.a[this.CLASSNAME].url(this.options.apiKey);"string"==typeof r?this.options.serverUrl=r:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod="string"==typeof t.httpMethod?t.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(i.a.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(i.a.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof t.protocol?t.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(i.a.getMessage("PARAM_UNKNOWN","protocol"))}if("undefined"==typeof window&&"JSONP"===this.options.protocol)throw new Error(i.a.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=t.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}var n=r(0),s=r(4),i=r(1),a=r(48),l=r(2),c=r(5);o.prototype={constructor:o,call:function(){function t(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(s,n,e)}function e(t){this.logger.trace("CommonService::onBuildRequest : ",t),this.callService.call(s,n,r)}function r(t){this.logger.trace("CommonService::onCallService : ",t),this.analyzeResponse.call(s,n,o)}function o(t){if(this.logger.trace("CommonService::onAnalyzeResponse : ",t),!t)return n.call(this,new l.a("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,t)}function n(t){this.logger.trace("CommonService::onError()");var e=t;e instanceof l.a||(e=new l.a(t.message)),this.options.onFailure.call(this,e)}this.logger.trace("CommonService::call ()");var s=this;t.call(s)},buildRequest:function(t,e){this.logger.error("overwritten method !"),t&&t.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")},callService:function(t,e){var r=null,o=this.request,n=!(!this.options.proxyURL||"XHR"!==this.options.protocol);this.options.serverUrl=s.a.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":"2.1.2"},!1),n&&("GET"===this.options.httpMethod&&(r=this.options.proxyURL+s.a.normalyzeUrl(this.options.serverUrl,this.request,!0),o=null),"POST"===this.options.httpMethod&&(r=this.options.proxyURL+s.a.normalyzeUrl(this.options.serverUrl,null,!0),o=this.request));var i=this,c={url:r||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"!==this.options.protocol,callbackSuffix:this.options.callbackSuffix,data:o,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(r){i.logger.trace("callService::onResponse()");var o=null;if("XHR"===i.options.protocol&&(i.logger.trace("Response XHR",r),o=r),"JSONP"===i.options.protocol){if(i.logger.trace("Response JSON",r),!r)return void t.call(i,new l.a("Le contenu de la reponse est vide !?"));if(r.http){if(200!==r.http.status)return void t.call(i,new l.a({status:r.http.status,message:r.http.error,type:l.a.TYPE_SRVERR}));o=r.xml,i.options.rawResponse&&(o=r)}else o=r}if("function"==typeof i.options.onBeforeParse){var n=i.options.onBeforeParse(o);"string"==typeof n&&(o=n)}i.response=o,e.call(i,o)},onFailure:function(e){i.logger.trace("callService::onFailure()"),e.type=l.a.TYPE_SRVERR,t.call(i,new l.a(e))},onTimeOut:function(){i.logger.trace("callService::onTimeOut()"),t.call(i,new l.a("TimeOut!"))}};a.a.send(c)},analyzeResponse:function(t,e){this.logger.error("overwritten method !"),t&&t.call(this,"This method must be overwritten !"),e.call(this,"This method must be overwritten !")}},e.a=o},function(t,e,r){"use strict";var o={normalyzeParameters:function(t){var e=null;if(t){var r=[];for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];n||(n=""),r.push(o+"="+n)}e=r.join("&")}return e},normalyzeUrl:function(t,e,r){var o=t;if(t){var n=t.indexOf("?");-1===n&&(o+="?"),-1!==n&&n!==t.length-1&&(o+="&")}return e&&(o+="string"==typeof e?e:this.normalyzeParameters(e)),r&&(o=encodeURIComponent(o)),o},indent:function(t,e){var r=t||0;return new Array(r+1).join("\t")+e}};e.a=o},function(t,e,r){"use strict";var o="wxs.ign.fr",n={ssl:!0,url:function(t,e){return(!1===n.ssl?"http://":"https://")+o.concat("/",t,e)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(t){return{"elevation-json":n.url(t,this._key["elevation-json"]),"elevation-xml":n.url(t,this._key["elevation-xml"]),"profil-json":n.url(t,this._key["profil-json"]),"profil-xml":n.url(t,this._key["profil-xml"]),wps:n.url(t,this._key.wps)}}},ProcessIsoCurve:{_key:{"iso-json":"/isochrone/isochrone.json","iso-xml":"/isochrone/isochrone.xml"},url:function(t){return{"iso-json":n.url(t,this._key["iso-json"]),"iso-xml":n.url(t,this._key["iso-xml"])}}},AutoComplete:{_key:"/ols/apis/completion",url:function(t){return n.url(t,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(t){return n.url(t,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(t){var e="";if(Array.isArray(t)&&t.length>0){e=t[0];for(var r=1;r<t.length;r++)e+=","+t[r]}return{apiKey:n.url(t,this._key.apiKey),apiKeys:n.url(t[0],this._key.apiKeys).replace("%KEYS%",e),aggregate:n.url(t,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(t){return n.url(t,this._key)}},Route:{_key:{ols:"/itineraire/ols","route-json":"/itineraire/rest/route.json","route-xml":"/itineraire/rest/route.xml"},url:function(t){return{ols:n.url(t,this._key.ols),"route-json":n.url(t,this._key["route-json"]),"route-xml":n.url(t,this._key["route-xml"])}}}};e.a=n},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("XML constructor cannot be called as a function.");this.logger=l.a.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,t&&(t.xmlString&&"string"==typeof t.xmlString&&(this.xmlString=t.xmlString,this.xmlDoc=n(t.xmlString)),t.reader&&this.setReader(t.reader))}function n(t){if("undefined"==typeof window){return(new(0,r(20).DOMParser)).parseFromString(t,"text/xml")}var e,o,n="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){o=new window.ActiveXObject("Microsoft.XMLDOM"),o.async=!1,o.loadXML(t);var s=o.parseError;if(s.errorCode)throw s.line&&s.linepos&&(n+="( ligne "+s.line+", colonne "+s.linepos),s.reason&&(n+=":  "+s.reason+")"),new Error(n);return o}if(window.DOMParser){e=new window.DOMParser;try{o=e.parseFromString(t,"text/xml")}catch(t){throw"SyntaxError"===t.message?new Error(n):new Error("Erreur lors du parsing de la réponse du service : "+t.message)}if(o.getElementsByTagName("parsererror").length>0)for(var i=o.getElementsByTagName("parsererror"),a=0;a<i.length;a++){var l=i[a].innerHTML;if(-1===l.indexOf("Huge input lookup"))throw n+="("+l+")",new Error(n)}else if(!o.documentElement)throw new Error(n);return o}throw new Error("Incompatible DOM Parser pour ce navigateur !")}function s(t){var e;return 9===t.nodeType?e=t.documentElement:1===t.nodeType&&(e=t),e}function i(t){var e={};if(t.attributes.length>0){var r=a(t);e.attributes=r}if(t.hasChildNodes())for(var o,n={},s=t.childNodes,l=0;l<s.length;l++)if(o=s[l],3===o.nodeType)e.textContent=o.nodeValue;else if(1===o.nodeType)if(n=i(o),e[o.nodeName]){if(!Array.isArray(e[o.nodeName])){var c=e[o.nodeName];e[o.nodeName]=[],e[o.nodeName].push(c)}e[o.nodeName].push(n)}else e[o.nodeName]=n;return e}function a(t){if(t.attributes.length>0){for(var e={},r=t.attributes,o=0;o<r.length;o++){var n=r[o];e[n.nodeName]=n.nodeValue}return e}}var l=r(0);o.prototype={constructor:o,getXMLString:function(){return this.xmlString},setXMLString:function(t){t&&"string"==typeof t&&(this.xmlString=t,this.xmlDoc=n(t))},getReader:function(){return this.reader},setReader:function(t){t&&t.read&&"function"==typeof t.read&&(this.reader=t)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(t){this.xmlDoc=t},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=n(this.xmlString)),this.xmlDoc){var t=s(this.xmlDoc);if(t){var e;return this.reader&&this.reader.read?e=this.reader.read(t):(e={},e[t.nodeName]=i(t)),e}return{}}}},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("GeocodeLocation constructor cannot be called as a function.");this.placeAttributes={},this.attributesList=[],this.serviceAttributes=[]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";var o=r(0),n={toJson:function(t,e,r){var n=o.a.getLogger(),s=null;try{if(!t)throw new Error("La chaine WKT n'est pas renseignée !");e||(e=function(t){console.log(t)}),r||(r=function(t){console.log(t)});var i,a;if(i=/(-?\d+\.?[0-9]*)\s(-?\d+\.?[0-9]+)/g,a="[$1,$2]",t=t.replace(i,a),i=/^(\w+)/,i.exec(t),"POLYGON"===RegExp.$1?(a='{"type" : "Polygon",',t=t.replace(RegExp.$1,a),i=/(\({2}?)/,a='"coordinates" : [[',t=t.replace(i,a),i=/(\){2}?)/,a="]]}",t=t.replace(i,a),i=/(\()/g,a="[",t=t.replace(i,a),i=/(\))/g,a="]",t=t.replace(i,a)):"LINESTRING"===RegExp.$1&&(a='{"type" : "LineString",',t=t.replace(RegExp.$1,a),i=/(\(\(?)/,a='"coordinates" : [',t=t.replace(i,a),i=/(\)\)?)/,a="]}",t=t.replace(i,a)),n.trace(t),!(s=JSON.parse(t)))throw new Error("Le JSON est vide !");if(!s.type)throw new Error("Le type de geometrie n'est pas connu !");if(!s.coordinates)throw new Error("La liste des points est vide !");e.call(this,s)}catch(t){if("SyntaxError"===t.name)return void r.call(this,"Erreur de parsing JSON !");r.call(this,t)}}};e.a=n},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur XLS()]"),!(this instanceof o))throw new TypeError("XLS constructor cannot be called as a function.");this.options={srsName:"EPSG:4326",maximumResponses:25};for(var e in t)t.hasOwnProperty(e)&&t[e]&&(this.options[e]=t[e])}var n=r(0),s=r(65),i=r(66),a=r(12);o.VERSION="1.2",o.prototype={requestString:null,namespace:!1,oService:null,constructor:o,template:'<?xml version="1.0" encoding="UTF-8"?>\n<XLS version="__VERSION__"\n__NAMESPACE__ \n__SCHEMALOCATION__>\n__REQUESTHEADER__\n__REQUEST__\n</XLS>\n',namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns:xls="http://www.opengis.net/xls"','xmlns:gml="http://www.opengis.net/gml"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"'},setService:function(t){if(!t)return void this.logger.trace("L'objet de type Service XSL n'est pas encore defini !?");t instanceof a.a?this.oService=t:this.logger.error("L'objet n'est pas du type 'LocationUtilityService' ou 'RouteService' !?")},getService:function(){return this.oService}},o.prototype.addNamespace=function(t,e){for(var r=t.key,o=!1,n=this.namespaceByDefault().split(" "),s=0;s<n.length;s++){if(n[s].split("=")[0]==="xmlns:"+r){o=!0;break}}if(!o)return this.logger.warn("L'ajout d'un nouvel namespace n'est pas encore implémenté !"),e;var i,a;return i=/<(\w+[\s>])/g,a="<"+r+":$1",e=e.replace(i,a),i=/<\/(\w+[\s>])/g,a="</"+r+":$1",e=e.replace(i,a),this.logger.trace("namespace",e),e},o.prototype.build=function(){var t=!!this.getService(),e="";e=this.template,e=e.replace(/__VERSION__/g,o.VERSION),e=e.replace(/__NAMESPACE__/g,this.namespaceByDefault),e=e.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault);var r=new s.a({srsName:this.options.srsName});e=e.replace(/__REQUESTHEADER__/g,r.toString());var n=new i.a({maximumResponses:this.options.maximumResponses,version:o.VERSION,methodName:t?this.getService().CLASSTYPE:null});return e=e.replace(/__REQUEST__/g,n.toString()),t&&(e=e.replace(/<!-- __REQUESTSERVICE__ -->/g,this.getService().toString())),e?(this.namespace&&(e=this.addNamespace({key:"xls",url:"http://www.opengis.net/xls"},e)),this.requestString=e,this.logger.trace("traduction tmpl",e),this.requestString):void this.logger.warn("traduction tmpl : empty request !?")},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AbstractService ()]"),!(this instanceof o))throw new TypeError("AbstractService constructor cannot be called as a function.");this.options=t||{};for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}var n=r(0);o.prototype={strRequest:null,oRequest:null,oFilter:null,constructor:o,addRequest:function(t){this.logger.error("overwritten method !")},addFilter:function(t){this.logger.error("overwritten method !")},toString:function(){this.logger.error("overwritten method !")}},e.a=o},function(t,e,r){"use strict";function o(){if(this.logger=n.a.getLogger("GeocodeFilterExtension"),this.logger.trace("[Constructeur GeocodeFilterExtension ()]"),!(this instanceof o))throw new TypeError("GeocodeFilterExtension constructor cannot be called as a function.");this.filters=[]}var n=r(0);o.prototype={constructor:o,addFilterExtensions:function(t){t&&this.filters.push(t)},getNames:function(){var t=[];for(var e in this.filters)t.push(this.filters[e].CLASSNAME);return this.logger.trace(t),t},getFilter:function(t){var e=null;for(var r in this.filters)this.filters[r].CLASSNAME===t&&(e=this.filters[r]);return this.logger.trace(e),e},getFilters:function(){return this.logger.trace(this.filters),this.filters},getAttributs:function(t){var e=[];for(var r in this.filters)this.filters[r].CLASSNAME===t&&(e=this.filters[r].attributesList);return this.logger.trace(e),e},setPlaceAttributs:function(t,e){var r=this.getFilter(t),o=this.getAttributs(t);for(var n in o){var s=o[n];e[s]&&(r.placeAttributes[s]=e[s])}},getPlaceAttributs:function(t){var e={};for(var r in this.filters)this.filters[r].CLASSNAME===t&&(e=this.filters[r].placeAttributes);return this.logger.trace(e),e}},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position={x:null,y:null},this.matchType=null,this.placeAttributes={},this.type=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(4),s=r(49),i=r.n(s),a={call:function(t){var e=o.a.getLogger("XHR");if(e.trace("[XHR::call()]"),i.a.polyfill(),!t.url)throw new Error("missing parameter : url is not defined !");if(!t.method)throw new Error("missing parameter : method is not defined !");t.format||(t.format="text");var r={};switch(r.url=t.url,r.data=t.data?t.data:null,r.method=t.method,r.timeOut=t.timeOut||0,r.scope=t.scope||this,r.proxy=t.proxy||null,r.content=t.content||null,r.headers=t.headers||{referer:"http://localhost"},t.method){case"DELETE":case"GET":break;case"PUT":case"POST":r.content=t.content?t.content:"application/x-www-form-urlencoded",r.headers=t.headers?t.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(t.format){case"text":this.__call(r).then(function(r){e.trace(r),t.onResponse.call(this,r)}).catch(function(e){t.onFailure.call(this,e)});break;case"json":this.__callJSON(r).then(function(r){e.trace(r),t.onResponse.call(this,r)}).catch(function(e){t.onFailure.call(this,e)});break;case"xml":this.__callXML(r).then(function(r){e.trace(r),t.onResponse.call(this,r)}).catch(function(e){t.onFailure.call(this,e)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(t){var e=o.a.getLogger("XHR");return e.trace("[XHR::__call()]"),new Promise(function(o,s){var i="POST"===t.method||"PUT"===t.method?1:0;t.data&&("object"==typeof t.data&&Object.keys(t.data).length||"string"==typeof t.data&&t.data.length)&&!i&&(t.url=n.a.normalyzeUrl(t.url,t.data)),e.trace("URL = ",t.url);var a=null;if("undefined"==typeof window){var l=r(52);t.data&&"string"==typeof t.data&&i&&(t.body=t.data),t.rejectUnauthorized=!1,l(t,function(t,e,r){!t&&200===e.statusCode&&r?o(r):s("Errors Occured on Http Request (nodejs) : "+t)})}else if(window.XMLHttpRequest){e.trace("XMLHttpRequest"),a=new XMLHttpRequest,a.open(t.method,t.url,!0),a.overrideMimeType=t.content;var c=null;t.timeOut>0&&(e.trace("XHR - TimeOut actif !"),c=window.setTimeout(function(){s({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})},t.timeOut)),i&&(e.trace("data = ",t.data),a.setRequestHeader("Content-type",t.content)),a.onerror=function(t){console.log(t),s(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(t){console.log(t),s(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onreadystatechange=function(t){if(4===a.readyState)if(200===a.status)window.clearTimeout(c),o(a.response);else{var e="Errors Occured on Http Request (status : '"+t.target.statusText+"' | url : '"+t.target.responseURL+"')",r=t.target.status;s({message:e,status:r})}};var u=t.data&&i?t.data:null;a.send(u)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");e.trace("XDomainRequest"),a=new XDomainRequest,a.open(t.method,t.url),a.overrideMimeType=t.content,t.timeOut>0&&(a.timeout=t.timeout,e.trace("XHR - TimeOut actif !")),i&&a.setRequestHeader("Content-type",t.content),a.onerror=function(){s(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},a.ontimeout=function(){s(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},a.onload=function(t){if(200===a.status)o(a.responseText);else{var e="Errors Occured on Http Request (status : '"+t.target.statusText+"' | url : '"+t.target.responseURL+"')",r=t.target.status;s({message:e,status:r})}};var p=t.data&&i?t.data:null;a.send(p)}})},__callJSON:function(t){return this.__call(t).then(JSON.parse).catch(function(e){console.log("_callJSON failed on : ",t.url,e)})},__callXML:function(t){return this.__call(t).then(function(t){var e;if("undefined"==typeof window){e=(new(0,r(20).DOMParser)).parseFromString(t,"text/xml")}else if(window.DOMParser){var o=new window.DOMParser;e=o.parseFromString(t,"text/xml")}else e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(t);return e}).catch(function(e){console.log("__callXML failed on : ",t.url,e)})}};e.a=a},function(e,r){e.exports=t},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",s.a.apply(this,arguments),this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}var n=r(0),s=r(22);o.prototype=Object.create(s.a.prototype,{zonly:{get:function(){return this._zonly},set:function(t){this._zonly=t}}}),o.prototype.constructor=o,o.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"zonly",v:this.zonly}),t.push({k:"format",v:this.format}),t},e.a=o},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=t||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}var n=r(0);o.CLASSNAME="AltiRequest",o.prototype={constructor:o,setPositions:function(t){for(var e=[],r=0;r<t.length;r++){var o=t[r];o.lon&&o.lat&&e.push(o)}this.positions=e},getPositions:function(t){if(!t)return this.positions;var e=this.positions.length-1;return t>e||t<e?(this.logger.warn("index out of range !"),this.positions):this.positions[t]},addPositions:function(t){for(var e=0;e<t.length;e++){var r=t[e];r.lon&&r.lat&&this.positions.push(t[e])}},getLon:function(){for(var t=[],e=0;e<this.positions.length;e++)t.push(this.positions[e].lon);return this.logger.trace(t),t.join(this.delimiter)},getLat:function(){for(var t=[],e=0;e<this.positions.length;e++)t.push(this.positions[e].lat);return this.logger.trace(t),t.join(this.delimiter)}},o.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"delimiter",v:this.delimiter}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"format",v:this.format}),t},e.a=o},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",s.a.apply(this,arguments),this.logger=n.a.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}var n=r(0),s=r(22);o.prototype=Object.create(s.a.prototype,{sampling:{get:function(){return this._sampling},set:function(t){this._sampling=t}}}),o.prototype.constructor=o,o.prototype.getData=function(){var t=[];return t.push({k:"lon",v:this.getLon()}),t.push({k:"lat",v:this.getLat()}),t.push({k:"indent",v:this.indent}),t.push({k:"crs",v:this.crs}),t.push({k:"sampling",v:this.sampling}),t.push({k:"format",v:this.format}),t},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("AutoConfResponse constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.territories={},this.tileMatrixSets={},this.services={}}o.prototype={constructor:o,isConfLoaded:function(t){if(t)return!!this.generalOptions.apiKeys[t]},getLayersId:function(t){return this.generalOptions.apiKeys[t]},getLayersConf:function(t){var e={},r=this.getLayersId(t);if(r)for(var o=0;o<r.length;o++){var n=r[o];e[n]=this.layers[n]}return e},getLayerConf:function(t){if(this.layers)return this.layers[t]},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(t){if(this.tileMatrixSets)return this.tileMatrixSets[t]},getTerritories:function(){return this.territories},getTerritoryConf:function(t){if(this.territories)return this.territories[t]},getServices:function(){return this.services},getServiceConf:function(t){if(this.services)return this.services[t]}},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Constraint constructor cannot be called as a function.");this.crs=null,this.bbox={left:null,right:null,top:null,bottom:null},this.minScaleDenominator=null,this.maxScaleDenominator=null,this.temporalExtent=[null,null]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Format constructor cannot be called as a function.");this.current=null,this.name=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Layer constructor cannot be called as a function.")}o.prototype={constructor:o,getName:function(){return this.name},getTitle:function(){return this.title},getDescription:function(){return this.description},getLayerId:function(){return this.layerId},getQuicklookUrl:function(){return this.quicklookUrl},getDefaultProjection:function(){return this.defaultProjection},getProjections:function(){var t=[];return t.push(this.defaultProjection),t.concat(this.additionalProjections)},getBBOX:function(){if(this.globalConstraint)return this.globalConstraint.bbox},getMinScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.minScaleDenominator},getMaxScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.maxScaleDenominator},getTMSID:function(){if(this.wmtsOptions)return this.wmtsOptions.tileMatrixSetLink},getServiceParams:function(){return this.serviceParams},getServerUrl:function(t){if(t&&this.serviceParams&&this.serviceParams.serverUrl)return this.serviceParams.serverUrl[t]},getLegends:function(){return this.legends},getMetadata:function(){return this.metadata},getStyles:function(){return this.styles},getDefaultStyle:function(){if(this.styles){for(var t,e=this.styles,r=0;r<e.length;r++)if(!0===e[r].current){t=e[r].name;break}return t}},getThematics:function(){return this.thematics},getDefaultFormat:function(){if(this.formats){for(var t,e=this.formats,r=0;r<e.length;r++)if(!0===e[r].current){t=e[r].name;break}return t}},getConstraints:function(){return this.constraints},getOriginators:function(){return this.originators},getDimensions:function(){return this.dimensions},getAggregatedLayers:function(){if(this.isAggregate)return this.aggregatedLayers}},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Legend constructor cannot be called as a function.");this.format=null,this.url=null,this.minScaleDenominator=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Metadata constructor cannot be called as a function.");this.format=null,this.url=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Originator constructor cannot be called as a function.");this.name=null,this.attribution=null,this.logo=null,this.url=null,this.constraints=[]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Service constructor cannot be called as a function.");this.title=null,this.serverUrl=null,this.version=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Style constructor cannot be called as a function.");this.name=null,this.title=null,this.current=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Territory constructor cannot be called as a function.");this.isDefault=null,this.defaultCRS=null,this.additionalCRS=[],this.geoBBOX={left:null,right:null,top:null,bottom:null},this.geoCenter={lon:null,lat:null},this.defaultOptions={resolution:null,minScaleDenominator:null,maxScaleDenominator:null},this.defaultLayers=[]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Thematic constructor cannot be called as a function.");this.inspire=null,this.name=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("TileMatrixSet constructor cannot be called as a function.");this.projection=null,this.nativeResolutions=[],this.matrixIds=[],this.tileMatrices={}}o.prototype={constructor:o,getResolutions:function(){return this.nativeResolutions},getMatrixIds:function(){return this.matrixIds},getProjection:function(){return this.projection},getTileMatrices:function(){return this.tileMatrices},getTopLeftCorner:function(){var t,e=this.getTileMatrices();if(e)for(var r in e)if(e.hasOwnProperty(r)){t=e[r].topLeftCorner;break}return t}},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("TileMatrix constructor cannot be called as a function.");this.matrixId=null,this.matrixHeight=null,this.matrixWidth=null,this.scaleDenominator=null,this.tileHeight=null,this.tileWidth=null,this.topLeftCorner=null}o.prototype={constructor:o,getTopLeftCorner:function(){return this.topLeftCorner},getScaleDenominator:function(){return this.scaleDenominator},getTileHeight:function(){return this.tileHeight},getTileWidth:function(){return this.tileWidth},getMatrixHeight:function(){return this.matrixHeight},getMatrixWidth:function(){return this.matrixWidth}},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("TileMatrixLimit constructor cannot be called as a function.");this.minTileRow=null,this.maxTileRow=null,this.minTileCol=null,this.maxTileCol=null}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur LocationUtilityService ()]"),!(this instanceof o))throw new TypeError("LocationUtilityService constructor cannot be called as a function.");this.CLASSNAME="LocationUtilityService",this.CLASSTYPE=null,s.a.apply(this,arguments),this.options&&(this.CLASSTYPE=this.options.location?"GeocodeRequest":this.options.position?"ReverseGeocodeRequest":null)}var n=r(0),s=r(12),i=r(67),a=r(69),l=r(13);o.prototype=Object.create(s.a.prototype,{}),o.prototype.constructor=o,o.prototype.addRequest=function(t){switch(this.CLASSTYPE=t.CLASSNAME,this.CLASSTYPE){case"GeocodeRequest":case"ReverseGeocodeRequest":this.oRequest=t;break;default:throw new Error("Ce n'est pas un objet de type 'LUS Request' !?")}},o.prototype.addFilter=function(t){t instanceof l.a&&(this.oFilter=t)},o.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("GeocodeRequest"===this.CLASSTYPE){var t={location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new i.a(t),this.oFilter&&this.oRequest.addFilter(this.oFilter)}else if("ReverseGeocodeRequest"===this.CLASSTYPE){var e={position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new a.a(e)}else this.logger.error("impossible de determiner le type de geocodage : Direct ou Inverse !?")}if(!this.oRequest)throw new Error("Type de Geocodage indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("DirectGeocodedLocation constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="DirectGeocodedLocation",this.accuracy=null}var n=r(15);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("ReverseGeocodedLocation constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="ReverseGeocodedLocation",this.searchCenterDistance=null}var n=r(15);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}o.prototype={constructor:o},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}o.prototype={constructor:o},e.a=o},function(t,e,r){t.exports=r(44)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r(45),n=r(5),s=r(9),i=r(10),a=r(41),l=r(42),c=r(24),u=r(25),p=r(26),h=r(27),f=r(28),g=r(29),d=r(30),m=r(31),E=r(32),_=r(33),v=r(34),y=r(36),R=r(37),S=r(35),w=r(14),A=r(15),P=r(39),T=r(40),b=r(18),O=r(16),x=r(17),C=r(19),N=r(2),M=r(4),I={servicesVersion:"2.1.2",servicesDate:"2019-02-14",extend:function(t,e){var r,o=t.split("."),n=this;r=o.length;for(var s=0;s<r;s++){void 0===n[o[s]]&&(n[o[s]]={});s===r-1&&(n[o[s]]=e),n=n[o[s]]}return this}};I.extend("Protocols",{}),I.extend("Protocols.XHR",C.a),I.extend("Services",o.a),I.extend("Services.AltiResponse",s.a),I.extend("Services.Alti.Elevation",i.a),I.extend("Services.AutoCompleteResponse",a.a),I.extend("Services.AutoComplete.SuggestedLocation",l.a),I.extend("Services.GetConfigResponse",c.a),I.extend("Services.Config.Constraint",u.a),I.extend("Services.Config.Format",p.a),I.extend("Services.Config.Layer",h.a),I.extend("Services.Config.Legend",f.a),I.extend("Services.Config.Metadata",g.a),I.extend("Services.Config.Originator",d.a),I.extend("Services.Config.Service",m.a),I.extend("Services.Config.Style",E.a),I.extend("Services.Config.Territory",_.a),I.extend("Services.Config.Thematic",v.a),I.extend("Services.Config.TileMatrix",y.a),I.extend("Services.Config.TileMatrixLimit",R.a),I.extend("Services.Config.TileMatrixSet",S.a),I.extend("Services.GeocodeResponse",w.a),I.extend("Services.Geocode.GeocodedLocation",A.a),I.extend("Services.Geocode.DirectGeocodedLocation",P.a),I.extend("Services.Geocode.ReverseGeocodedLocation",T.a),I.extend("Services.IsoCurveResponse",b.a),I.extend("Services.RouteResponse",O.a),I.extend("Services.Route.RouteInstruction",x.a),I.extend("Error",N.a),I.extend("Helper",M.a),I.extend("Services.DefaultUrl",n.a),e.default=I},function(t,e,r){"use strict";var o=r(46),n=r(60),s=r(63),i=r(78),a=r(82),l=r(84),c=r(96),u={getConfig:function(t){new n.a(t).call()},getAltitude:function(t){new o.a(t).call()},geocode:function(t){new s.a(t).call()},reverseGeocode:function(t){new i.a(t).call()},autoComplete:function(t){new a.a(t).call()},route:function(t){new l.a(t).call()},isoCurve:function(t){new c.a(t).call()}};e.a=u},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!t.positions)throw new Error(s.a.getMessage("PARAM_MISSING","positions"));if(0===t.positions.length)throw new Error(s.a.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=t.positions,this.options.outputFormat="string"==typeof t.outputFormat?t.outputFormat.toLowerCase():"xml",this.options.sampling=t.sampling||null,this.options.api="string"==typeof t.api?t.api.toUpperCase():"REST","REST"===this.options.api&&(this.options.httpMethod="GET"),this.options.zonly=t.zonly||!1,!this.options.serverUrl){var e=l.a.Alti.url(this.options.apiKey),r=null;switch(this.options.api){case"WPS":r=e.wps;break;case"REST":r=e[(t.sampling?"profil":"elevation")+"-"+this.options.outputFormat];break;default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","api"))}if(!r)throw new Error("Url by default not found !");this.options.serverUrl=r,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var c=this.options.serverUrl.substring(i+1);if(c&&c.length<5)switch(this.logger.trace("Server Extension URL : "+c),c.toLowerCase()){case"json":case"xml":this.options.outputFormat=c.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(5),c=r(54),u=r(58);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(t,e){var r={httpMethod:this.options.httpMethod,onSuccess:function(t){this.request=t,e.call(this,this.request)},onError:t,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};c.a.build(r)},o.prototype.analyzeResponse=function(t,e){if(this.response){var r={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};u.a.build(r)}else t.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},e.a=o},function(t,e,r){var o,n;!function(s,i){"use strict";o=i,void 0!==(n="function"==typeof o?o.call(e,r,e,t):o)&&(t.exports=n)}(0,function(){"use strict";function t(t,e){var r=t[e];if("function"==typeof r.bind)return r.bind(t);try{return Function.prototype.bind.call(r,t)}catch(e){return function(){return Function.prototype.apply.apply(r,[t,arguments])}}}function e(e){return"debug"===e&&(e="log"),typeof console!==a&&(void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):i)}function r(t,e){for(var r=0;r<l.length;r++){var o=l[r];this[o]=r<t?i:this.methodFactory(o,t,e)}this.log=this.debug}function o(t,e,o){return function(){typeof console!==a&&(r.call(this,e,o),this[t].apply(this,arguments))}}function n(t,r,n){return e(t)||o.apply(this,arguments)}function s(t,e,o){function s(t){var e=(l[t]||"silent").toUpperCase();if(typeof window!==a){try{return void(window.localStorage[p]=e)}catch(t){}try{window.document.cookie=encodeURIComponent(p)+"="+e+";"}catch(t){}}}function i(){var t;if(typeof window!==a){try{t=window.localStorage[p]}catch(t){}if(typeof t===a)try{var e=window.document.cookie,r=e.indexOf(encodeURIComponent(p)+"=");-1!==r&&(t=/^([^;]+)/.exec(e.slice(r))[1])}catch(t){}return void 0===u.levels[t]&&(t=void 0),t}}var c,u=this,p="loglevel";t&&(p+=":"+t),u.name=t,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=o||n,u.getLevel=function(){return c},u.setLevel=function(e,o){if("string"==typeof e&&void 0!==u.levels[e.toUpperCase()]&&(e=u.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(c=e,!1!==o&&s(e),r.call(u,e,t),typeof console===a&&e<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(t){i()||u.setLevel(t,!1)},u.enableAll=function(t){u.setLevel(u.levels.TRACE,t)},u.disableAll=function(t){u.setLevel(u.levels.SILENT,t)};var h=i();null==h&&(h=null==e?"WARN":e),u.setLevel(h,!1)}var i=function(){},a="undefined",l=["trace","debug","info","warn","error"],c=new s,u={};c.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=u[t];return e||(e=u[t]=new s(t,c.getLevel(),c.methodFactory)),e};var p=typeof window!==a?window.log:void 0;return c.noConflict=function(){return typeof window!==a&&window.log===c&&(window.log=p),c},c.getLoggers=function(){return u},c})},function(t,e,r){"use strict";var o=r(4),n=r(19),s=r(53),i={send:function(t){var e=t||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if("undefined"==typeof window&&"JSONP"===t.protocol)return void console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS");if("XHR"===t.protocol||"json"===t.format?e.wrap=!1:"JSONP"===t.protocol&&"xml"===t.format&&(e.wrap=!0),e.callback=(t.protocol,null),e.output=e.wrap?"json":null,e.wrap){var r={};r.output=e.output,r.callback=e.callback,delete r.callback,e.url=o.a.normalyzeUrl(t.url,r)}switch(e.protocol){case"XHR":"GET"===t.method&&t.nocache&&(e.url=o.a.normalyzeUrl(e.url,{t:(new Date).getTime()})),n.a.call(e);break;case"JSONP":e.data&&(e.url=o.a.normalyzeUrl(e.url,e.data)),s.a.call(e);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}};e.a=i},function(t,e,r){(function(e,r){!function(e,r){t.exports=r()}(0,function(){"use strict";function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function o(t){return"function"==typeof t}function n(t){V=t}function s(t){j=t}function i(){return void 0!==G?function(){G(l)}:a()}function a(){var t=setTimeout;return function(){return t(l,1)}}function l(){for(var t=0;t<k;t+=2){(0,K[t])(K[t+1]),K[t]=void 0,K[t+1]=void 0}k=0}function c(t,e){var r=this,o=new this.constructor(p);void 0===o[J]&&x(o);var n=r._state;if(n){var s=arguments[n-1];j(function(){return T(n,o,s,r._result)})}else w(r,o,t,e);return o}function u(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var r=new e(p);return v(r,t),r}function p(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function g(t){try{return t.then}catch(t){return tt.error=t,tt}}function d(t,e,r,o){try{t.call(e,r,o)}catch(t){return t}}function m(t,e,r){j(function(t){var o=!1,n=d(r,e,function(r){o||(o=!0,e!==r?v(t,r):R(t,r))},function(e){o||(o=!0,S(t,e))},"Settle: "+(t._label||" unknown promise"));!o&&n&&(o=!0,S(t,n))},t)}function E(t,e){e._state===$?R(t,e._result):e._state===Z?S(t,e._result):w(e,void 0,function(e){return v(t,e)},function(e){return S(t,e)})}function _(t,e,r){e.constructor===t.constructor&&r===c&&e.constructor.resolve===u?E(t,e):r===tt?(S(t,tt.error),tt.error=null):void 0===r?R(t,e):o(r)?m(t,e,r):R(t,e)}function v(e,r){e===r?S(e,h()):t(r)?_(e,r,g(r)):R(e,r)}function y(t){t._onerror&&t._onerror(t._result),A(t)}function R(t,e){t._state===Q&&(t._result=e,t._state=$,0!==t._subscribers.length&&j(A,t))}function S(t,e){t._state===Q&&(t._state=Z,t._result=e,j(y,t))}function w(t,e,r,o){var n=t._subscribers,s=n.length;t._onerror=null,n[s]=e,n[s+$]=r,n[s+Z]=o,0===s&&t._state&&j(A,t)}function A(t){var e=t._subscribers,r=t._state;if(0!==e.length){for(var o=void 0,n=void 0,s=t._result,i=0;i<e.length;i+=3)o=e[i],n=e[i+r],o?T(r,o,n,s):n(s);t._subscribers.length=0}}function P(t,e){try{return t(e)}catch(t){return tt.error=t,tt}}function T(t,e,r,n){var s=o(r),i=void 0,a=void 0,l=void 0,c=void 0;if(s){if(i=P(r,n),i===tt?(c=!0,a=i.error,i.error=null):l=!0,e===i)return void S(e,f())}else i=n,l=!0;e._state!==Q||(s&&l?v(e,i):c?S(e,a):t===$?R(e,i):t===Z&&S(e,i))}function b(t,e){try{e(function(e){v(t,e)},function(e){S(t,e)})}catch(e){S(t,e)}}function O(){return et++}function x(t){t[J]=et++,t._state=void 0,t._result=void 0,t._subscribers=[]}function C(){return new Error("Array Methods must be provided an Array")}function N(t){return new rt(this,t).promise}function M(t){var e=this;return new e(q(t)?function(r,o){for(var n=t.length,s=0;s<n;s++)e.resolve(t[s]).then(r,o)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function I(t){var e=this,r=new e(p);return S(r,t),r}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function D(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var o=null;try{o=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===o&&!e.cast)return}t.Promise=ot}var U=void 0;U=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var q=U,k=0,G=void 0,V=void 0,j=function(t,e){K[k]=t,K[k+1]=e,2===(k+=2)&&(V?V(l):W())},X="undefined"!=typeof window?window:void 0,Y=X||{},H=Y.MutationObserver||Y.WebKitMutationObserver,B="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,K=new Array(1e3),W=void 0;W=B?function(){return function(){return e.nextTick(l)}}():H?function(){var t=0,e=new H(l),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}():z?function(){var t=new MessageChannel;return t.port1.onmessage=l,function(){return t.port2.postMessage(0)}}():void 0===X?function(){try{var t=Function("return this")().require("vertx");return G=t.runOnLoop||t.runOnContext,i()}catch(t){return a()}}():a();var J=Math.random().toString(36).substring(2),Q=void 0,$=1,Z=2,tt={error:null},et=0,rt=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[J]||x(this.promise),q(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&R(this.promise,this._result))):S(this.promise,C())}return t.prototype._enumerate=function(t){for(var e=0;this._state===Q&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,o=r.resolve;if(o===u){var n=g(t);if(n===c&&t._state!==Q)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(r===ot){var s=new r(p);_(s,t,n),this._willSettleAt(s,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(o(t),e)},t.prototype._settledAt=function(t,e,r){var o=this.promise;o._state===Q&&(this._remaining--,t===Z?S(o,r):this._result[e]=r),0===this._remaining&&R(o,this._result)},t.prototype._willSettleAt=function(t,e){var r=this;w(t,void 0,function(t){return r._settledAt($,e,t)},function(t){return r._settledAt(Z,e,t)})},t}(),ot=function(){function t(e){this[J]=O(),this._result=this._state=void 0,this._subscribers=[],p!==e&&("function"!=typeof e&&L(),this instanceof t?b(this,e):D())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this,r=e.constructor;return o(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return ot.prototype.then=c,ot.all=N,ot.race=M,ot.resolve=u,ot.reject=I,ot._setScheduler=n,ot._setAsap=s,ot._asap=j,ot.polyfill=F,ot.Promise=ot,ot})}).call(e,r(50),r(51))},function(t,e){function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function n(t){if(u===setTimeout)return setTimeout(t,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function s(t){if(p===clearTimeout)return clearTimeout(t);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function i(){d&&f&&(d=!1,f.length?g=f.concat(g):m=-1,g.length&&a())}function a(){if(!d){var t=n(i);d=!0;for(var e=g.length;e;){for(f=g,g=[];++m<e;)f&&f[m].run();m=-1,e=g.length}f=null,d=!1,s(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var u,p,h=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:r}catch(t){u=r}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(t){p=o}}();var f,g=[],d=!1,m=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];g.push(new l(t,e)),1!==g.length||d||n(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.prependListener=c,h.prependOnceListener=c,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,r){t.exports=e},function(t,e,r){"use strict";var o=r(0),n={uuid:function(){var t=Math.floor(Date.now());return function(){return t++}}(),call:function(t){var e=o.a.getLogger("JSONP");if(e.trace("[JSONP::call ()]"),!t)throw e.error("missing parameter : options !"),new Error("missing parameter : options !");if(!t.url)throw e.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(t.timeOut||(e.info("setting 'options.timeOut' default value"),t.timeOut=0),!t.onResponse)throw e.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var r="string"==typeof t.callbackSuffix?t.callbackSuffix:this.uuid(),n=!1,s=!1,i=t.url.indexOf("callback=");if(-1!==i){n=!0;var a=t.url.indexOf("&",i);-1===a&&(a=t.url.length);var l=t.url.substring(i+9,a);l&&(s=!0,t.callbackName=l,e.info("setting 'options.callbackName' value ("+t.callbackName+") from 'options.url' parameter"))}if(!n){var c=t.url.indexOf("?");-1===c?t.url=t.url+"?callback=":c===t.url.length?t.url=t.url+"callback=":t.url=t.url+"&callback=",e.info("setting callback default key in 'options.url' : "+t.url)}var u=!!t.callbackName||s;if(s||(t.callbackName||(e.info("setting 'options.callbackName' default value"),t.callbackName="callback",(r||""===r)&&(t.callbackName+=r)),t.url=t.url.replace("callback=","callback="+t.callbackName),e.info("setting callback function name in 'options.url' : "+t.url)),t.onTimeOut||(e.info("setting 'options.onTimeOut' default value"),t.onTimeOut=function(){console.log("TimeOut while invoking url : "+t.url)}),!u){var p=this,h=null;t.timeOut>0&&(h=window.setTimeout(function(){window[t.callbackName]=function(){},t.onTimeOut(),p._deleteScript(r)},t.timeOut)),window[t.callbackName]=function(e){window.clearTimeout(h),t.onResponse(e),p._deleteScript(r)}}this._createScript(r,t.url)},_createScript:function(t,e){var r,o=document.getElementById("results"+t);r=document.createElement("script"),r.setAttribute("type","text/javascript"),r.setAttribute("src",e),r.setAttribute("charset","UTF-8"),r.setAttribute("id","results"+t),r.setAttribute("async","true");var n=document.documentElement||document.getElementsByTagName("head")[0];null===o?n.appendChild(r):n.replaceChild(r,o)},_deleteScript:function(t){var e=document.getElementById("results"+t);if(e){var r=e.parentNode||document.documentElement;if(!r)return;r.removeChild(e)}}};e.a=n},function(t,e,r){"use strict";var o=r(0),n=r(2),s=r(55),i=r(56),a={build:function(t){o.a.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var e=null,r={type:t.sampling?"Profil":"Elevation",method:t.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};r.param.positions=t.positions,r.param.format=t.outputFormat,r.param.sampling=t.sampling,r.param.zonly=t.zonly;var a=!(null===t.onError||"function"!=typeof t.onError),l=!(null===t.onSuccess||"function"!=typeof t.onSuccess),c=null;switch(t.api){case"REST":var u=new s.a(r);if(!u.processRequestString()){if(c="Error in process request (rest) !",a)return void t.onError.call(t.scope,new n.a(c));throw new Error(c)}e=u.requestString;break;case"WPS":if(r.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(e=i.a.build(r))){if(c="Error in process request (wps) !",a)return void t.onError.call(t.scope,new n.a(c));throw new Error(c)}break;default:if(c="Type of API is not supported by service (REST or WPS) !",a)return void t.onError.call(t.scope,new n.a(c));throw new Error(c)}return l&&t.onSuccess.call(t.scope,e),e}};e.a=a},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof o))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=t||{},!this.options)throw new Error(s.a.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(s.a.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new i.a(this.options.param);break;case"Profil":this.DataObject=new a.a(this.options.param);break;default:throw new Error(s.a.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}var n=r(0),s=r(1),i=r(21),a=r(23);o.prototype={requestString:null,constructor:o,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:"lon=__LON__\nlat=__LAT__\nindent=__INDENT__\ncrs='__CRS__'\n",input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var t="";return"POST"===this.method?t=this.template.post.value:"GET"===this.method&&(t=this.template.get.value),t=t.replace(/__LON__/g,this.DataObject.getLon()),t=t.replace(/__LAT__/g,this.DataObject.getLat()),t=t.replace(/__INDENT__/g,this.DataObject.indent),t=t.replace(/__CRS__/g,this.DataObject.crs),t+=this.__addDataInputs(),this.logger.trace("traduction tmpl",t),this.requestString=t,this.requestString},__addDataInputs:function(){this.logger.trace("AltiRequestREST::addDataInput ()");var t;if("POST"===this.method)t=this.template.post;else{if("GET"!==this.method)throw new Error("No other HTTP method supported by the service !");t=this.template.get}var e=null;if("AltiElevationRequest"===this.DataObject.CLASSNAME)return e=t.input.point,e.replace(/__ZONLY__/g,this.DataObject.zonly);if("AltiProfilRequest"===this.DataObject.CLASSNAME)return e=t.input.profil,e.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(1),s=r(57),i=r(21),a=r(23),l={build:function(t){if(o.a.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!t)throw new Error(n.a.getMessage("PARAM_EMPTY","options"));if(!t.type)throw new Error(n.a.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var e=null;switch(t.type){case"Elevation":t.wps.identifier="gs:WPSElevation",e=new i.a(t.param);break;case"Profil":t.wps.identifier="gs:WPSLineElevation",e=new a.a(t.param);break;default:throw new Error(n.a.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var r={data:e,method:t.method,param:t.wps},l=new s.a(r);if(!l.processRequestString())throw new Error("Enable to process request !");return l.requestString}};e.a=l},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof o))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=t||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}var n=r(0);o.prototype={requestString:null,constructor:o,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=\x3c!-- __DATAINPUTS__ --\x3e",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs>\x3c!-- __DATAINPUTS__ --\x3e</wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var t="";if("POST"===this.method)t=this.template.post.value;else{if("GET"!==this.method)return this.logger.error("No other method supported by the service !"),!1;t=this.template.get.value}return t=t.replace(/__SERVICE__/g,this.paramservice),t=t.replace(/__VERSION__/g,this.paramversion),t=t.replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput),t=t.replace(/__IDENTIFIER__/g,this.paramidentifier),t=t.replace(/__REQUEST__/g,this.paramrequest),"POST"===this.method&&(t=t.replace(/__NAMESPACE__/g,this.namespaceByDefault),t=t.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(t=t.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=t,this.logger.trace("traduction tmpl",t),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var t="GET"===this.method?this.template.get.input:this.template.post.input,e="GET"===this.method?";":"",r="",o=this,n=this.DataObject.getData(),s=0;s<n.length;s++)!function(s){e&&(e=s===n.length-1?"":";"),r=r.concat(o.__addDataInput(t,n[s].k,n[s].v),e)}(s);return r},__addDataInput:function(t,e,r){var o=t;return o=o.replace(/__KEY__/g,e),o=o.replace(/__DATA__/g,r)},setMethod:function(t){"GET"===t||"POST"===t?this.method=t:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(59),l=r(9),c=r(10),u={build:function(t){var e=o.a.getLogger("AltiResponseFactory");e.trace(["AltiResponseFactory::build()"]);var r=null;if(!t.response)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(t.rawResponse)e.trace("analyze response : raw"),r=t.response;else{switch(t.outputFormat){case"xml":e.trace("analyze response : xml");try{var u=new i.a({reader:a.a});if("string"==typeof t.response?u.setXMLString(t.response):u.setXMLDoc(t.response),!(r=u.parse()))throw new Error(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(e){var p=e.message;return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",p),status:200,type:s.a.TYPE_SRVERR}))}break;case"json":e.trace("analyze response : json"),e.trace("analyze response : ",typeof t.response);var h;if(h="string"==typeof t.response?JSON.parse(t.response):t.response,h.error)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",h.error.description),status:200,type:s.a.TYPE_SRVERR}));if(h){var f,g=h.elevations,d=new l.a;if(Array.isArray(g)&&g.length)for(var m=0;m<g.length;m++)f=new c.a,"object"==typeof g[m]?(g[m].lon&&(f.lon=g[m].lon),g[m].lat&&(f.lat=g[m].lat),g[m].z&&(f.z=g[m].z),g[m].acc&&(f.acc=g[m].acc)):"number"==typeof g[m]&&(f.z=g[m]),Array.isArray(d.elevations)&&d.elevations.push(f);r=d}if(!r)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:s.a.TYPE_UNKERR,status:-1}));break;default:return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:s.a.TYPE_UNKERR,status:-1}))}if(r.exceptionReport)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",r.exceptionReport),type:s.a.TYPE_SRVERR,status:200}));if(r.error){var E=r.error.description;return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",E),type:s.a.TYPE_SRVERR,status:200}))}}t.onSuccess.call(t.scope,r)}};e.a=u},function(t,e,r){"use strict";var o=r(9),n=r(10),s={};s.READERS={elevations:function(t){var e=new o.a;if(t.hasChildNodes())for(var r,n,i=t.childNodes,a=0;a<i.length;a++)r=i[a],s.READERS[r.nodeName]&&(n=s.READERS[r.nodeName](r),e.elevations.push(n));return e},elevation:function(t){var e=new n.a;if(t.hasChildNodes())for(var r,o=t.childNodes,i=0;i<o.length;i++)r=o[i],s.READERS[r.nodeName]&&s.READERS[r.nodeName](r,e);return e},lat:function(t,e){var r=t.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");e.lat=parseFloat(r.nodeValue)},lon:function(t,e){var r=t.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");e.lon=parseFloat(r.nodeValue)},z:function(t,e){var r=t.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!e)return e=new n.a,e.z=parseFloat(r.nodeValue),e;e.z=parseFloat(r.nodeValue)},acc:function(t,e){var r=t.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");e.acc=parseFloat(r.nodeValue)},exceptionreport:function(t){var e={};if(t.hasChildNodes())for(var r,o=t.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(e.exceptionReport=s.READERS.exception(r));return e},exception:function(t){var e={},r=t.getAttribute("exceptionCode");r&&(e.exceptionCode=r);var o=t.firstChild;return o&&3===o.nodeType&&(e.exception=o.nodeValue),e},error:function(t){var e={error:{}};if(t.hasChildNodes())for(var r,o=t.childNodes,n=0;n<o.length;n++){r=o[n];var s;1===r.nodeType&&"code"===r.nodeName&&(s=r.firstChild)&&3===s.nodeType&&(e.error.code=s.nodeValue),1===r.nodeType&&"description"===r.nodeName&&(s=r.firstChild)&&3===s.nodeType&&(e.error.description=s.nodeValue)}return e}},s.read=function(t){if("elevations"===t.nodeName){return s.READERS.elevations(t)}if("ExceptionReport"===t.nodeName){return s.READERS.exceptionreport(t)}if("error"===t.nodeName){return s.READERS.error(t)}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},e.a=s},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","AutoConf"));if(this.CLASSNAME="AutoConf",t||(t={}),t.protocol=t.protocol||"JSONP",c.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.AutoConf"),this.logger.trace("[Constructeur AutoConf (options)]"),!this.options.serverUrl&&!this.options.serverUrl){var e=l.a.AutoConf.url(this.options.apiKey);this.options.layerId?this.options.serverUrl=e.aggregate+this.options.layerId:Array.isArray(this.options.apiKey)&&this.options.apiKey.length>0?this.options.serverUrl=e.apiKeys:this.options.serverUrl=e.apiKey}"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"xml"}var n=r(0),s=r(1),i=r(4),a=r(2),l=r(5),c=r(3),u=r(61);o.prototype=Object.create(c.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(t,e){var r="undefined"!=typeof window?window:{};if(r.Gp&&r.Gp.Config&&r.Gp.Config.generalOptions&&r.Gp.Config.layers&&r.Gp.Config.generalOptions.apiKeys[this.options.apiKey]){if(!this.options.layerId)return this.logger.warn("Gp.Config existe déjà pour cette clé"),void this.options.onSuccess.call(this,r.Gp.Config);if(r.Gp.Config.layers[this.options.layerId]&&r.Gp.Config.layers[this.options.layerId].aggregatedLayers)return this.logger.warn("Gp.Config existe déjà pour cette clé et cette couche"),void this.options.onSuccess.call(this,r.Gp.Config)}this.request="";var o;o=-1===this.options.serverUrl.indexOf("http://"),!o&&this.layerId&&(this.request=i.a.normalyzeParameters({layerId:this.layerId})),this.request||""===this.request?e.call(this,this.request):t.call(this,new a.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(t,e){if(this.response){var r={layerId:this.options.layerId,response:this.response,rawResponse:this.options.rawResponse,onSuccess:e,onError:t,scope:this};u.a.build(r)}else t.call(this,new a.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(62),l={build:function(t){o.a.getLogger("AutoConfResponseFactory").trace(["AutoConfResponseFactory::build()"]);var e=null;if(!t.response)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(t.rawResponse)e=t.response;else{try{var r=new i.a({reader:a.a});"string"==typeof t.response?r.setXMLString(t.response):r.setXMLDoc(t.response),e=r.parse()}catch(e){var l=e.message;return"string"==typeof t.response?l+="\n (raw response service'"+t.response+"')":l+="\n (raw response service'"+t.response.documentElement.innerHTML+"')",void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",l),status:200,type:s.a.TYPE_SRVERR}))}var c=!0;for(var u in e)e.hasOwnProperty(u)&&(c=!1);if(c)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY_2")));if(e.exceptionReport)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}var p="undefined"!=typeof window?window:{};p.Gp||(p.Gp={}),p.Gp.Config?this.mergeConfig(p.Gp.Config,e,t.layerId):p.Gp.Config=e,t.onSuccess.call(t.scope,p.Gp.Config)},mergeConfig:function(t,e,r){if(e&&t){for(var o in e)if(e.hasOwnProperty(o))if("generalOptions"===o)for(var n in e[o].apiKeys)e[o].apiKeys.hasOwnProperty(n)&&!t.generalOptions.apiKeys[n]&&(t.generalOptions.apiKeys[n]=e[o].apiKeys[n]);else if(t[o])for(var s in e[o])e[o].hasOwnProperty(s)&&!t[o][s]&&(t[o][s]=e[o][s]);if(r){var i=[];for(var a in e.layers)e.layers.hasOwnProperty(a)&&i.push(a);t.layers[r]&&(t.layers[r].aggregatedLayers=i)}}}};e.a=l},function(t,e,r){"use strict";function o(t){if(t.attributes.length>0){for(var e={},r=t.attributes,o=0;o<r.length;o++){var n=r[o];e[n.nodeName]=n.nodeValue}return e}}function n(t,e){if(t.hasChildNodes())for(var r,o,s,i=t.childNodes,a=0;a<i.length;a++)if(r=i[a],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,s=r.prefix||R.DEFAULTPREFIX,R.READERS[s][o]){var l=R.READERS[s][o];l(r,e)}else n(r,e)}function s(t){var e,r="";return t.hasChildNodes()&&(e=t.firstChild,3!==e.nodeType&&4!==e.nodeType||(r=e.nodeValue)),r}function i(t){if(t.attributes.length>0){var e=o(t);for(var r in e)if(e.hasOwnProperty(r)){if("version"===r&&e.version!==R.VERSION)return void console.log("[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing");if("xmlns"===r){if(e[r]!==R.NAMESPACES.xmlns)return void console.log("[AutoConfResponseReader] autoconf response default namespace is not the expected one");continue}var n=r.split(":")[0],s=r.split(":")[1];if("xmlns"===n&&s&&R.NAMESPACES[s]&&R.NAMESPACES[s]!==e[r])return void console.log("[AutoConfResponseReader] autoconf response "+r+" namespace is not the expected one");if("schemaLocation"===s&&e[r]!==R.SCHEMALOCATION[0]&&e[r]!==R.SCHEMALOCATION[1])return void console.log("[AutoConfResponseReader] autoconf response schema location is not the expected one")}}}var a=r(24),l=r(25),c=r(26),u=r(27),p=r(28),h=r(29),f=r(30),g=r(31),d=r(32),m=r(33),E=r(34),_=r(35),v=r(36),y=r(37),R={};R.VERSION="1.1.0",R.NAMESPACES={xmlns:"http://www.opengis.net/context",gpp:"http://api.ign.fr/geoportail",ows:"http://www.opengis.net/ows/1.1",sld:"http://www.opengis.net/sld",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},R.SCHEMALOCATION=["http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd","http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf.xsd"],R.DEFAULTPREFIX="context",R.READERS={context:{ViewContext:function(t){i(t);var e=new a.a;return n(t,e),e},Title:function(t,e){e&&e.generalOptions?e.generalOptions.title=s(t):e&&e.lyr&&(e.lyr.title=s(t))},Abstract:function(t,e){e&&e.lyr&&(e.lyr.description=s(t))},Server:function(t,e){var r=t.getAttribute("service"),o=t.getAttribute("title"),s=t.getAttribute("version");if(r)if(e&&e.services&&"object"==typeof e.services&&!e.services[r]){var i=new g.a;i.title=o,i.version=s,n(t,i),e.services[r]=i}else e&&e.lyr&&(e.lyr.serviceParams||(e.lyr.serviceParams={}),e.lyr.serviceParams.id=r,e.lyr.serviceParams.version=s)},OnlineResource:function(t,e){e&&e.hasOwnProperty("serverUrl")&&(e.serverUrl=t.getAttribute("xlink:href"))},LayerList:function(t,e){if(n(t,e),e&&e.layers&&e.generalOptions&&e.services)for(var r in e.layers)if(e.layers.hasOwnProperty(r)){var o=e.layers[r],s=o.apiKeys;if(s&&Array.isArray(s))for(var i=0;i<s.length;i++){var a=s[i];e.generalOptions.apiKeys&&(e.generalOptions.apiKeys[a]&&Array.isArray(e.generalOptions.apiKeys[a])||(e.generalOptions.apiKeys[a]=[]),e.generalOptions.apiKeys[a].push(r))}var l=o.serviceParams;if(l&&l.id&&!e.services[l.id]){var c=new g.a;l.serverUrl&&(c.serverUrl=l.serverUrl),l.version&&(c.version=l.version),e.services[l.id]=c}if(o.wmtsOptions&&o.wmtsOptions.tileMatrixSetLink&&e.tileMatrixSets){var u=o.wmtsOptions.tileMatrixSetLink,p=e.tileMatrixSets;for(var h in p)p.hasOwnProperty(h)&&h===u&&(o.defaultProjection=p[h].projection)}}},Layer:function(t,e){if(e&&e.layers){var r={lyr:new u.a,lyrId:null},o=t.getAttribute("hidden");r.lyr.hidden="1"===o;var s=t.getAttribute("queryable");if(r.lyr.queryable="1"===s,n(t,r),r.lyrId){if(r.lyr.serviceParams&&r.lyr.serviceParams.id){var i=r.lyr.serviceParams.id;if(-1!==i.toUpperCase().indexOf("OPENLS")||-1!==i.toUpperCase().indexOf("ELEVATION")){var a=r.lyrId.split("$")[0];r.lyrId=a+"$"+i}}r.lyr.layerId=r.lyrId,e.layers[r.lyrId]=r.lyr}}},Name:function(t,e){e&&e.lyr&&(e.lyr.name=s(t))},SRS:function(t,e){e&&e.lyr&&(e.lyr.defaultProjection=s(t))},Format:function(t,e){if(e&&e.lyr){var r=new c.a,o=t.getAttribute("current");r.current="1"===o,r.name=s(t),e.lyr.formats&&Array.isArray(e.lyr.formats)||(e.lyr.formats=[]),e.lyr.formats.push(r)}},Style:function(t,e){if(e&&e.lyr){var r=new d.a,o=t.getAttribute("current");if(r.current="1"===o||1===o,t.hasChildNodes)for(var n,i,a=t.childNodes,l=0;l<a.length;l++)n=a[l],1===n.nodeType&&(i=n.localName||n.baseName||n.nodeName,"Name"===i?r.name=s(n):"Title"===i&&(r.title=s(n)));e.lyr.styles&&Array.isArray(e.lyr.styles)||(e.lyr.styles=[]),e.lyr.styles.push(r)}},Dimension:function(t,e){var r=t.getAttribute("name"),o=s(t);e&&e.lyr&&(e.lyr.dimensions||(e.lyr.dimensions={}),"Type"===r?e.lyr.dimensions.type=o:"VisibilityRange"===r?e.lyr.dimensions.visibilityRange=o:"VisibilityMode "===r?e.lyr.dimensions.visibilityMode=o:"GeometricType"===r?e.lyr.dimensions.geometricType=o:"NoDataValue"===r&&(e.lyr.dimensions.noDataValue=o))}},gpp:{Theme:function(t,e){e&&e.generalOptions&&e.generalOptions.hasOwnProperty("theme")&&(e.generalOptions.theme=s(t))},defaultGMLGFIStyleUrl:function(t,e){e&&e.generalOptions&&e.generalOptions.hasOwnProperty("defaultGMLGFIStyle")&&(e.generalOptions.defaultGMLGFIStyle=s(t))},Territory:function(t,e){var r=t.getAttribute("id");if(r){var o=new m.a,s=t.getAttribute("default");o.isDefault="1"===s,n(t,o),e&&e.territories&&"object"==typeof e.territories&&(e.territories[r]=o)}},defaultCRS:function(t,e){e&&e.hasOwnProperty("defaultCRS")&&(e.defaultCRS=s(t))},AdditionalCRS:function(t,e){var r=s(t);r&&e&&(Array.isArray(e.additionalCRS)?e.additionalCRS.push(r):(e.additionalProjections&&Array.isArray(e.additionalProjections)||(e.additionalProjections=[]),e.additionalProjections.push(r)))},DefaultLayer:function(t,e){var r=t.getAttribute("layerId");r&&e&&Array.isArray(e.defaultLayers)&&e.defaultLayers.push(r)},BoundingBox:function(t,e){if(e){var r=s(t).split(",");if(4===r.length){var o={left:parseFloat(r[0]),right:parseFloat(r[2]),top:parseFloat(r[3]),bottom:parseFloat(r[1])},n=t.getAttribute("minT"),i=t.getAttribute("maxT");if(e.hasOwnProperty("geoBBOX"))e.geoBBOX=o;else if(e.hasOwnProperty("bbox"))if(e.bbox.left||e.bbox.right||e.bbox.top||e.bbox.bottom){e.multiConstraints||(e.multiConstraints=[]);var a=new l.a;a.bbox=o,a.temporalExtent=[n,i],e.multiConstraints.push(a)}else e.bbox=o,e.temporalExtent=[n,i];else e.globalConstraint||(e.globalConstraint=new l.a),e.globalConstraint.bbox=o,e.globalConstraint.temporalExtent=[n,i]}}},Resolution:function(t,e){var r=s(t);r&&e&&e.defaultOptions&&e.defaultOptions.hasOwnProperty("resolution")&&(e.defaultOptions.resolution=parseFloat(r))},x:function(t,e){var r=s(t);r&&e&&e.geoCenter&&e.geoCenter.hasOwnProperty("lon")&&(e.geoCenter.lon=parseFloat(r))},y:function(t,e){var r=s(t);r&&e&&e.geoCenter&&e.geoCenter.hasOwnProperty("lat")&&(e.geoCenter.lat=parseFloat(r))},Resolutions:function(t,e){e&&e.generalOptions&&e.generalOptions.hasOwnProperty("wgs84Resolutions")&&(e.generalOptions.wgs84Resolutions=s(t).split(","))},Layer:function(t,e){if(e&&e.hasOwnProperty("lyrId")&&e.lyr){e.lyrId=t.getAttribute("id");var r=t.getAttribute("aggregate"),o=t.getAttribute("more");(r||o)&&(e.lyr.isAggregate=!0),n(t,e.lyr)}},Constraint:function(t,e){var r=new l.a;if(n(t,r),e)if(e.constraints&&Array.isArray(e.constraints)||(e.constraints=[]),r.multiConstraints&&Array.isArray(r.multiConstraints)){var o=new l.a;o.crs=r.crs,o.bbox=r.bbox,o.minScaleDenominator=r.minScaleDenominator,o.maxScaleDenominator=r.maxScaleDenominator,o.temporalExtent=r.temporalExtent,e.constraints.push(o);for(var s=0;s<r.multiConstraints.length;s++)o=new l.a,o.crs=r.crs,o.minScaleDenominator=r.minScaleDenominator,o.maxScaleDenominator=r.maxScaleDenominator,o.bbox=r.multiConstraints[s].bbox,o.temporalExtent=r.multiConstraints[s].temporalExtent,e.constraints.push(o)}else e.constraints.push(r)},CRS:function(t,e){e&&e.hasOwnProperty("crs")&&(e.crs=s(t))},Thematic:function(t,e){if(e){var r=new E.a;r.inspire=!1,r.name=s(t),e.thematics&&Array.isArray(e.thematics)||(e.thematics=[]),e.thematics.push(r)}},InspireThematic:function(t,e){if(e){var r=new E.a;r.inspire=!0,r.name=s(t),e.thematics&&Array.isArray(e.thematics)||(e.thematics=[]),e.thematics.push(r)}},Originator:function(t,e){if(e){var r=new f.a;r.name=t.getAttribute("name"),n(t,r),e.originators&&Array.isArray(e.originators)||(e.originators=[]),e.originators.push(r)}},Attribution:function(t,e){e&&e.hasOwnProperty("attribution")&&(e.attribution=s(t))},Logo:function(t,e){e&&e.hasOwnProperty("logo")&&(e.logo=s(t))},URL:function(t,e){e&&e.hasOwnProperty("url")&&(e.url=s(t))},Legend:function(t,e){var r=new p.a;n(t,r),e&&(e.legends&&Array.isArray(e.legends)||(e.legends=[]),e.legends.push(r))},LegendURL:function(t,e){if(e&&e.hasOwnProperty("format")&&(e.format=t.getAttribute("format"),t.hasChildNodes)){var r=t.childNodes[0];"OnlineResource"===(r.localName||r.baseName||r.nodeName)&&e.hasOwnProperty("url")&&(e.url=r.getAttribute("xlink:href"))}},QuickLook:function(t,e){if(t.hasChildNodes){var r=t.childNodes[0];"OnlineResource"===(r.localName||r.baseName||r.nodeName)&&e&&(e.quicklookUrl=r.getAttribute("xlink:href"))}},MetadataURL:function(t,e){if(e){var r=new h.a;if(r.format=t.getAttribute("format"),t.hasChildNodes){var o=t.childNodes[0];"OnlineResource"===(o.localName||o.baseName||o.nodeName)&&(r.url=o.getAttribute("xlink:href"))}e.metadata||Array.isArray(e.metadata)||(e.metadata=[]),e.metadata.push(r)}},Key:function(t,e){if(e){var r=t.getAttribute("id");e.apiKeys&&Array.isArray(e.apiKeys)||(e.apiKeys=[]),e.apiKeys.push(r);var o=s(t);e.serviceParams||(e.serviceParams={}),e.serviceParams.serverUrl||(e.serviceParams.serverUrl={}),e.serviceParams.serverUrl[r]||(e.serviceParams.serverUrl[r]=o)}}},ows:{Identifier:function(t,e){e&&e.hasOwnProperty("TMS")?e.identifier=s(t):e&&e.hasOwnProperty("matrixId")&&(e.matrixId=s(t))},SupportedCRS:function(t,e){e&&e.TMS&&e.TMS.hasOwnProperty("projection")&&(e.TMS.projection=s(t))}},sld:{MinScaleDenominator:function(t,e){var r=s(t);r&&e&&(e.hasOwnProperty("defaultOptions")?e.defaultOptions.minScaleDenominator=parseFloat(r):e.lyr?(e.lyr.globalConstraint||(e.lyr.globalConstraint=new l.a),e.lyr.globalConstraint.minScaleDenominator=parseFloat(r)):e.hasOwnProperty("minScaleDenominator")&&(e.minScaleDenominator=parseFloat(r)))},MaxScaleDenominator:function(t,e){var r=s(t);r&&e&&(e.hasOwnProperty("defaultOptions")?e.defaultOptions.maxScaleDenominator=parseFloat(r):e.lyr?(e.lyr.globalConstraint||(e.lyr.globalConstraint=new l.a),e.lyr.globalConstraint.maxScaleDenominator=parseFloat(r)):e.hasOwnProperty("maxScaleDenominator")&&(e.maxScaleDenominator=parseFloat(r)))}},wmts:{TileMatrixSetLimits:function(t,e){if(e){var r={};n(t,r),e.wmtsOptions||(e.wmtsOptions={}),e.wmtsOptions.tileMatrixSetLimits=r}},TileMatrixLimits:function(t,e){var r,o=new y.a;if(t.hasChildNodes){for(var n=t.childNodes,i=0;i<n.length;i++){var a=n[i],l=a.localName||a.baseName||a.nodeName;"TileMatrix"===l?r=s(a):"MinTileRow"===l?o.minTileRow=s(a):"MaxTileRow"===l?o.maxTileRow=s(a):"MinTileCol"===l?o.minTileCol=s(a):"MaxTileCol"===l&&(o.maxTileCol=s(a))}r&&e&&!e[r]&&(e[r]=o)}},TileMatrixSet:function(t,e){if(e&&e.tileMatrixSets){var r={};r.TMS=new _.a,r.resolutions=[],n(t,r);var o=r.TMS.tileMatrices;for(var i in o)o.hasOwnProperty(i)&&r.TMS.matrixIds.push(i);if(("IGNF:WGS84G"===r.TMS.getProjection()||"EPSG:4326"===r.TMS.getProjection())&&e.generalOptions&&Array.isArray(e.generalOptions.wgs84Resolutions))for(var a=e.generalOptions.wgs84Resolutions,l=0;l<a.length;l++)r.resolutions[l]=parseFloat(a[l]);Array.isArray(r.resolutions)&&void 0!==r.resolutions.sort&&r.resolutions.sort(function(t,e){return e-t}),r.TMS.nativeResolutions=r.resolutions,e.tileMatrixSets[r.identifier]=r.TMS}else e&&!e.wmtsOptions&&(e.wmtsOptions={}),e.wmtsOptions.tileMatrixSetLink=s(t)},TileMatrix:function(t,e){if(e){var r=new v.a;if(n(t,r),e.TMS&&e.TMS.getProjection()){var o=e.TMS.getProjection();if("EPSG:3857"===o||"EPSG:2154"===o){var s=28e-5*r.scaleDenominator;e.resolutions&&Array.isArray(e.resolutions)&&e.resolutions.push(s)}}e.TMS&&e.TMS.tileMatrices&&(e.TMS.tileMatrices[r.matrixId]=r)}},ScaleDenominator:function(t,e){var r=s(t);r&&e&&e.hasOwnProperty("scaleDenominator")&&(e.scaleDenominator=parseFloat(r))},TopLeftCorner:function(t,e){var r=s(t).split(" ");r&&e&&(e.topLeftCorner={},e.topLeftCorner.x=parseFloat(r[0]),e.topLeftCorner.y=parseFloat(r[1]))},TileWidth:function(t,e){var r=s(t);r&&e&&e.hasOwnProperty("tileWidth")&&(e.tileWidth=parseInt(r,10))},TileHeight:function(t,e){var r=s(t);r&&e&&e.hasOwnProperty("tileHeight")&&(e.tileHeight=parseInt(r,10))},MatrixWidth:function(t,e){var r=s(t);r&&e&&e.hasOwnProperty("matrixWidth")&&(e.matrixWidth=parseInt(r,10))},MatrixHeight:function(t,e){var r=s(t);r&&e&&e.hasOwnProperty("matrixHeight")&&(e.matrixHeight=parseInt(r,10))}},serviceException:function(t){var e={};if(t.hasChildNodes())for(var r,o=t.childNodes,n=0;n<o.length;n++)r=o[n],"exception"===r.nodeName&&(e.exceptionReport=R.READERS.exception(r));return e},exception:function(t){var e={},r=t.getAttribute("code");r&&(e.exceptionCode=r);var o=t.firstChild;return o&&3===o.nodeType&&(e.exception=o.nodeValue),e}},R.read=function(t){if("ViewContext"===t.nodeName){var e=t.prefix||R.DEFAULTPREFIX;return R.READERS[e][t.nodeName](t)}if("serviceException"===t.nodeName){return R.READERS[t.nodeName](t)}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},e.a=R},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","Geocode"));if(this.CLASSNAME="Geocode",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]"),!t.location)throw new Error(s.a.getMessage("PARAM_MISSING","location"));if("object"==typeof t.location&&0===Object.keys(t.location).length)throw new Error(s.a.getMessage("PARAM_EMPTY","location"));if("string"==typeof t.location&&0===t.location.length)throw new Error(s.a.getMessage("PARAM_EMPTY","location"));this.options.location=t.location,t.filterOptions&&"object"==typeof t.filterOptions||(this.options.filterOptions=t.filterOptions={type:["StreetAddress"]}),0===Object.keys(t.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var e=Object.keys(t.filterOptions),r=0;r<e.length;r++){var i=e[r];-1!==["department","number","postalCode","insee","importance","ID","IDTR","absorbedCity","sheet","section","inseeRegion","inseeDepartment"].indexOf(i)&&"string"!=typeof t.filterOptions[i]&&(t.filterOptions[i]=t.filterOptions[i].toString()),t.filterOptions[i]||delete this.options.filterOptions[i]}this.options.filterOptions.type=t.filterOptions.type||["StreetAddress"],this.options.maximumResponses=t.maximumResponses||25,this.options.returnFreeForm=t.returnFreeForm||!1,this.options.srs=t.srs||"EPSG:4326",this.options.outputFormat=this.options.rawResponse?"":"xml"}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(64),c=r(76);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(t,e){var r={httpMethod:this.options.httpMethod,location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:this.options.srs,maximumResponses:this.options.maximumResponses};this.request=l.a.build(r),this.request?e.call(this,this.request):t.call(this,new i.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(t,e){if(this.response){var r={response:this.response,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};c.a.build(r)}else t.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(11),s=r(38),i=r(13),a=r(72),l=r(73),c=r(74),u=r(75),p={build:function(t){var e=o.a.getLogger("DirectGeocodeRequestFactory");e.trace(["DirectGeocodeRequestFactory::build()"]);var r=null,p=new i.a;p.addFilterExtensions(new u.a),p.addFilterExtensions(new a.a),p.addFilterExtensions(new l.a),p.addFilterExtensions(new c.a);var h=new s.a({location:t.location,returnFreeForm:t.returnFreeForm,filterOptions:t.filterOptions});h.addFilter(p);var f=new n.a({srsName:t.srs,maximumResponses:t.maximumResponses});if(f.namespace=!0,f.setService(h),r=f.build(),"GET"===t.httpMethod){r="qxml="+encodeURIComponent(r).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}return e.trace(r),r}};e.a=p},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur RequestHeader ()]"),!(this instanceof o))throw new TypeError("RequestHeader constructor cannot be called as a function.");this.options=t||{srsName:"EPSG:4326"};for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}var n=r(0);o.prototype={requestString:null,template:'<RequestHeader srsName="__SRSNAME__"/>',constructor:o,toString:function(){var t=null;return t=this.template,t=t.replace(/__SRSNAME__/g,this.options.srsName),this.requestString=t,this.requestString}},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur Request ()]"),!(this instanceof o))throw new TypeError("Request constructor cannot be called as a function.");this.options=t||{maximumResponses:25,methodName:null,version:"1.2"};for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}var n=r(0);o.prototype={requestString:null,template:'<Request maximumResponses="__MAXRESPONSES__" methodName="__METHODNAME__" requestID="__UUID__" version="__VERSION__">\x3c!-- __REQUESTSERVICE__ --\x3e</Request>',constructor:o,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},toString:function(){var t=null;return t=this.template,t=t.replace(/__MAXRESPONSES__/g,this.options.maximumResponses),t=t.replace(/__METHODNAME__/g,this.options.methodName),t=t.replace(/__UUID__/g,this.guid()),t=t.replace(/__VERSION__/g,this.options.version),this.requestString=t,this.requestString}},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur GeocodeRequest ()]"),!(this instanceof o))throw new TypeError("GeocodeRequest constructor cannot be called as a function.");this.options=t||{};for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);this.CLASSNAME="GeocodeRequest"}var n=r(0),s=r(68),i=r(13);o.prototype={strRequest:null,oAddress:null,oFilter:null,template:'<GeocodeRequest returnFreeForm="__RETURNFREEFORM__">__ADDRESS__</GeocodeRequest>',addAddress:function(t){t instanceof s.a&&(this.oAddress=t)},addFilter:function(t){t instanceof i.a&&(this.oFilter=t)},constructor:o,toString:function(){var t="";if(t=this.template,!this.oAddress){var e={};if(e.location=this.options.location,e.type=this.options.filterOptions.type||["StreetAddress"],e.filter=this.options.filterOptions,delete e.filter.type,this.oFilter){e.filter={};for(var r in e.type){var o=e.type[r],n=this.oFilter.getFilter(o);if(n){for(var i=this.options.filterOptions,a=n.attributesList,l=0;l<a.length;l++){var c=a[l];if(i[c]){var u=n.serviceAttributes[l];n.placeAttributes[u]=i[c],this.logger.trace("Selection du filtre '"+c+"' sur le type '"+o+"'.")}}var p=n.placeAttributes;for(var h in p)p.hasOwnProperty(h)&&(e.filter[h]=p[h])}else this.logger.warn("Le filtre '"+o+"' n'existe pas !?")}}if(this.oAddress=new s.a(e),!this.oAddress)throw new Error("La construction de l'adresse n'est pas correctement definie !?")}return t=t.replace(/__ADDRESS__/g,this.oAddress.toString()),t=t.replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=t,this.strRequest}},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger("Address"),this.logger.trace("[Constructeur Address ()]"),!(this instanceof o))throw new TypeError("Address constructor cannot be called as a function.");if(this.options=t||{location:{},type:["StreetAddress"],filter:{}},!t.location)throw new Error("l'option 'location' n'est pas renseignée !");for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}var n=r(0);o.prototype={constructor:o,requestString:null,template:{address:'<Address countryCode="__COUNTRYCODE__">__LOCATION____PLACE____POSTALCODE____ENVELOPE__</Address>',location:{freeFormAddress:"<freeFormAddress>__FREEFORMADDRESSVALUE__</freeFormAddress>",streetAddress:{container:"<StreetAddress>__STREET____BUILDING__</StreetAddress>",building:'<Building number="__BUILDINGVALUE__"/>',street:"<Street>__STREETVALUE__</Street>"}},place:'<Place type="__PLACETYPE__">__PLACEVALUE__</Place>',postalCode:"<PostalCode>__POSTALCODEVALUE__</PostalCode>",envelope:"<gml:Envelope><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>"}},o.prototype.toString=function(){var t=null;if(t=this.template.address,t=t.replace(/__COUNTRYCODE__/g,this.options.type),"string"==typeof this.options.location){var e=this.template.location.freeFormAddress;e=e.replace(/__FREEFORMADDRESSVALUE__/g,this.options.location),t=t.replace(/__LOCATION__/g,e)}else{var r="",o="";this.options.location.number&&(r=this.template.location.streetAddress.building,r=r.replace(/__BUILDINGVALUE__/g,this.options.location.number)),this.options.location.street&&(o=this.template.location.streetAddress.street,o=o.replace(/__STREETVALUE__/g,this.options.location.street));var n=this.template.location.streetAddress.container;n=n.replace(/__STREET__/g,o),n=n.replace(/__BUILDING__/g,r),t=t.replace(/__LOCATION__/g,n)}var s="";this.options.location.postalCode&&(s=this.template.postalCode,s=s.replace(/__POSTALCODEVALUE__/g,this.options.location.postalCode));var i="";if(this.options.filter){var a=this.options.filter.bbox;a&&(i=this.template.envelope,i=i.replace(/__LEFT__/g,a.left),i=i.replace(/__BOTTOM__/g,a.bottom),i=i.replace(/__RIGHT__/g,a.right),i=i.replace(/__TOP__/g,a.top))}var l=[],c="";if(this.options.filter){var u=this.options.filter;for(var p in u)"bbox"!==p&&(c=this.template.place,c=c.replace(/__PLACETYPE__/g,p),c=c.replace(/__PLACEVALUE__/g,u[p]),l.push(c))}var h="";return this.options.location.city&&(h=this.template.place,h=h.replace(/__PLACETYPE__/g,"Municipality"),h=h.replace(/__PLACEVALUE__/g,this.options.location.city),l.push(h)),t=t.replace(/__POSTALCODE__/g,s),t=t.replace(/__PLACE__/g,l.join("\n")),t=t.replace(/__ENVELOPE__/g,i),this.requestString=t,this.requestString},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur ReverseGeocodeRequest ()]"),!(this instanceof o))throw new TypeError("ReverseGeocodeRequest constructor cannot be called as a function.");this.options=t||{};for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);this.CLASSNAME="ReverseGeocodeRequest"}var n=r(0),s=r(70),i=r(71);o.prototype={strRequest:null,oPosition:null,oPreference:null,constructor:o,template:'<ReverseGeocodeRequest returnFreeForm="__RETURNFREEFORM__">__POSITION____PREFERENCE__</ReverseGeocodeRequest>',addPosition:function(t){t instanceof s.a&&(this.oPosition=t)},addPreferences:function(t){t instanceof i.a&&(this.oPreference=t)},toString:function(){var t="";if(t=this.template,!this.oPreference&&(this.oPreference=new i.a(this.options.filterOptions.type||["StreetAddress"]),!this.oPreference))throw new Error("Les preferences ne sont pas definies !?");if(t=t.replace(/__PREFERENCE__/g,this.oPreference.toString()),!this.oPosition){var e={position:this.options.position,filter:{}};if(this.options.filterOptions&&(e.filter=this.options.filterOptions,delete e.filter.type),this.oPosition=new s.a(e),!this.oPosition)throw new Error("La position et ses filtres ne sont pas definis !?")}return t=t.replace(/__POSITION__/g,this.oPosition.toString()),t=t.replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=t,this.strRequest}},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger("Position"),this.logger.trace("[Constructeur Position ()]"),!(this instanceof o))throw new TypeError("Position constructor cannot be called as a function.");if(this.options=t||{},!t.position)throw new Error("l'option 'position' n'est pas renseignée !");for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}var n=r(0);o.prototype={constructor:o,requestString:null,template:{position:"<Position>__GMLPOINT____GMLFILTER__</Position>",gml:{point:'<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point>',pos:null,filter:{bbox:'<gml:Envelope xmlns:gml="http://www.opengis.net/gml"><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>',circle:'<gml:CircleByCenterPoint xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos><gml:radius>__RADIUS__</gml:radius></gml:CircleByCenterPoint>',polygon:'<gml:Polygon xmlns:gml="http://www.opengis.net/gml"><gml:exterior><gml:LinearRing><gml:posList>__XY__</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>',multipolygon:null}}}},o.prototype.toString=function(){var t=this.template.position,e=this.template.gml.point;e=e.replace(/__X__/g,this.options.position.x),e=e.replace(/__Y__/g,this.options.position.y);var r="";if(this.options.filter){var o=this.options.filter;for(var n in o)switch(n){case"circle":r=this.template.gml.filter[n],r=r.replace(/__X__/g,o[n].x),r=r.replace(/__Y__/g,o[n].y),r=r.replace(/__RADIUS__/g,o[n].radius);break;case"bbox":r=this.template.gml.filter[n],r=r.replace(/__LEFT__/g,o[n].left),r=r.replace(/__BOTTOM__/g,o[n].bottom),r=r.replace(/__RIGHT__/g,o[n].right),r=r.replace(/__TOP__/g,o[n].top);break;case"polygon":r=this.template.gml.filter[n];for(var s="",i=o[n],a=0;a<i.length;a++){var l=i[a];if(Array.isArray(l)){this.logger.error("Holes are not implemented !");break}(l.x&&l.y||0===l.x||0===l.y)&&(s+=l.x+" "+l.y),i.length!==a+1&&(s+=" ")}r=r.replace(/__XY__/g,s);break;case"multipolygon":this.logger.warn("Filter '"+n+"' is not yet implemented !");break;default:this.logger.error("This filter '"+n+"' is not useful !")}}return t=t.replace(/__GMLPOINT__/g,e),t=t.replace(/__GMLFILTER__/g,r),this.requestString=t,this.requestString},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger("Preference"),this.logger.trace("[Constructeur Preference ()]"),!(this instanceof o))throw new TypeError("Preference constructor cannot be called as a function.");this.type=t}var n=r(0);o.prototype={constructor:o,requestString:null,template:"<ReverseGeocodePreference>__TYPE__</ReverseGeocodePreference>"},o.prototype.toString=function(){for(var t=[],e="",r=0;r<this.type.length;r++)e=this.template,e=e.replace(/__TYPE__/g,this.type[r]),t.push(e);return this.strRequest=t.join("\n"),this.strRequest},e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("StreetAddress constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="StreetAddress",this.attributesList=["bbox","ID","IDTR","quality","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","ID","IDTR","Qualite","Territoire","Commune","Departement","INSEE","Municipality"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("PositionOfInterest constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="PositionOfInterest",this.attributesList=["bbox","importance","nature","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","Importance","Nature","Territoire","Commune","Departement","INSEE","Municipality"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("CadastralParcel constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="CadastralParcel",this.attributesList=["absorbedCity","sheet","number","section","commune","department","insee","municipality","origin"],this.serviceAttributes=["CommuneAbsorbee","Feuille","Numero","Section","Commune","Departement","INSEE","Municipality","Type"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,e.a=o},function(t,e,r){"use strict";function o(){if(!(this instanceof o))throw new TypeError("Administratif constructor cannot be called as a function.");n.a.apply(this,arguments),this.CLASSNAME="Administratif",this.attributesList=["bbox","prefecture","inseeRegion","inseeDepartment","municipality"],this.serviceAttributes=["bbox","Prefecture","InseeRegion","InseeDepartement","Municipality"]}var n=r(7);o.prototype=Object.create(n.a.prototype),o.prototype.constructor=o,e.a=o},function(t,e,r){"use strict";var o=r(2),n=r(1),s=r(6),i=r(77),a={build:function(t){var e=null;if(!t.response)return void t.onError.call(t.scope,new o.a({message:n.a.getMessage("SERVICE_RESPONSE_EMPTY"),type:o.a.TYPE_SRVERR,status:-1}));if(t.rawResponse)e=t.response;else{try{var r=new s.a({reader:i.a});if("string"==typeof t.response?r.setXMLString(t.response):r.setXMLDoc(t.response),!(e=r.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(e){var a=e.message;return"string"==typeof t.response?a+="('"+t.response+"')":a+="('"+t.response.documentElement.innerHTML+"')",void t.onError.call(t.scope,new o.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE",a),type:o.a.TYPE_UNKERR,status:-1}))}if(e.exceptionReport)return void t.onError.call(t.scope,new o.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:o.a.TYPE_SRVERR,status:200}))}t.onSuccess.call(t.scope,e)}};e.a=a},function(t,e,r){"use strict";function o(t){if(t.attributes.length>0){for(var e={},r=t.attributes,o=0;o<r.length;o++){var n=r[o];e[n.nodeName]=n.nodeValue}return e}}function n(t,e){if(t.hasChildNodes())for(var r,o,s,i=t.childNodes,a=0;a<i.length;a++)if(r=i[a],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,s=r.prefix||p.DEFAULTPREFIX,p.READERS[s][o]){var l=p.READERS[s][o];l(r,e)}else n(r,e)}function s(t){var e,r="";return t.hasChildNodes()&&(e=t.firstChild,3===e.nodeType&&(r=e.nodeValue)),r}function i(t){if(t.attributes.length>0){var e=o(t);for(var r in e)if(e.hasOwnProperty(r)){if("version"===r&&e.version!==p.VERSION)return void console.log("[DirectGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===r){if(e[r]!==p.NAMESPACES[p.DEFAULTPREFIX])return void console.log("[DirectGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var n=r.split(":")[0],s=r.split(":")[1];if("xmlns"===n&&s&&p.NAMESPACES[s]&&p.NAMESPACES[s]!==e[r])return void console.log("[DirectGeocodeResponseReader] geocode response "+r+" namespace is not the expected one");if("schemaLocation"===s&&p.SCHEMALOCATION!==e[r])return void console.log("[DirectGeocodeResponseReader] geocode response schema location is not the expected one")}}}var a=r(1),l=r(2),c=r(14),u=r(39),p={};p.VERSION="1.2",p.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},p.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",p.DEFAULTPREFIX="xls",p.READERS={xls:{XLS:function(t){var e=new c.a;return i(t),n(t,e),e},GeocodedAddress:function(t,e){var r=new u.a;n(t,r),e&&Array.isArray(e.locations)&&e.locations.push(r)},GeocodeMatchCode:function(t,e){var r=t.getAttribute("accuracy");r&&e&&(e.accuracy=parseFloat(r));var o=t.getAttribute("matchType");o&&e&&(e.matchType=o)},Address:function(t,e){var r=t.getAttribute("countryCode");e&&r&&(e.type=r),n(t,e)},freeFormAddress:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&(e.placeAttributes.freeform=s(t))},Building:function(t,e){var r=t.getAttribute("number");e&&e.hasOwnProperty("placeAttributes")&&(r?e.placeAttributes.number=r:t.getAttribute("buildingName")?e.placeAttributes.number=t.getAttribute("buildingName"):t.getAttribute("subdivision")&&(e.placeAttributes.number=t.getAttribute("subdivision")))},Street:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&("StreetAddress"===e.type?e.placeAttributes.street=s(t):"CadastralParcel"===e.type&&(e.placeAttributes.cadastralParcel=s(t)))},Place:function(t,e){var r=t.getAttribute("type"),o=s(t);if(e&&e.hasOwnProperty("placeAttributes"))if("Municipality"===r)e.placeAttributes.municipality=o;else if("Bbox"===r){var n=o.split(";");4===n.length&&(e.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===r?e.placeAttributes.commune=o:"Departement"===r?e.placeAttributes.department=o:"INSEE"===r?e.placeAttributes.insee=o:"Qualite"===r?e.placeAttributes.quality=o:"Territoire"===r?e.placeAttributes.territory=o:"ID"===r?e.placeAttributes.ID=o:"ID_TR"===r?e.placeAttributes.IDTR=o:"Importance"===r?e.placeAttributes.importance=parseInt(o,10):"Nature"===r?e.placeAttributes.nature=o:"Numero"===r?e.placeAttributes.number=o:"Feuille"===r?e.placeAttributes.sheet=o:"Section"===r?e.placeAttributes.section=o:"CommuneAbsorbee"===r?e.placeAttributes.absorbedCity=o:"Arrondissement"===r?o&&(e.placeAttributes.arrondissement=o):"Type"===r?e.placeAttributes.origin=o:"Prefecture"===r?e.placeAttributes.prefecture=o:"InseeRegion"===r?e.placeAttributes.inseeRegion=o:"InseeDepartment"===r&&(e.placeAttributes.inseeDepartment=o)},PostalCode:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&(e.placeAttributes.postalCode=s(t))},Error:function(t){var e=t.getAttribute("message"),r=t.getAttribute("errorCode"),o=a.a.getMessage("SERVICE_RESPONSE_EXCEPTION","("+r+") : "+e);throw new l.a({message:o,type:l.a.TYPE_SRVERR})}},gml:{pos:function(t,e){var r=s(t);e&&r&&(e.position={x:parseFloat(r.split(" ")[0]),y:parseFloat(r.split(" ")[1])})}},ExceptionReport:function(t){var e={};if(t.hasChildNodes())for(var r,o=t.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(e.exceptionReport=p.READERS.Exception(r));return e},Exception:function(t){var e={},r=t.getAttribute("exceptionCode");r&&(e.exceptionCode=r);var o=t.firstChild;return o&&3===o.nodeType&&(e.exception=o.nodeValue),e}},p.read=function(t){if("XLS"===t.nodeName){var e=t.prefix;e||(e=p.DEFAULTPREFIX);return p.READERS[e][t.nodeName](t)}if("ExceptionReport"===t.nodeName){return p.READERS[t.nodeName](t)}var r=a.a.getMessage("SERVICE_RESPONSE_ANALYSE",t.nodeName);throw new l.a({message:r,type:l.a.TYPE_UNKERR,status:200})},e.a=p},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));if(this.CLASSNAME="ReverseGeocode",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]"),!t.position)throw new Error(s.a.getMessage("PARAM_MISSING","position"));if(null===t.position.x)throw new Error(s.a.getMessage("PARAM_MISSING","position.x"));if(null===t.position.y)throw new Error(s.a.getMessage("PARAM_MISSING","position.y"));this.options.position=t.position,t.filterOptions&&"object"==typeof t.filterOptions||(this.options.filterOptions=t.filterOptions={type:["StreetAddress"]}),0===Object.keys(t.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var e=Object.keys(t.filterOptions),r=0;r<e.length;r++){var i=e[r];t.filterOptions[i]&&0!==Object.keys(t.filterOptions[i]).length||delete this.options.filterOptions[i]}if(this.options.filterOptions.type=t.filterOptions.type||["StreetAddress"],!Array.isArray(this.options.filterOptions.type))throw new Error(s.a.getMessage("PARAM_TYPE","filterOptions.type"));if(this.options.maximumResponses=t.maximumResponses||25,this.options.returnFreeForm=t.returnFreeForm||!1,this.options.srs=t.srs||"CRS:84",-1===o.geoEPSG.indexOf(this.options.srs)){if(this.options.position={x:this.options.position.y,y:this.options.position.x},this.options.filterOptions&&this.options.filterOptions.circle){var l=this.options.filterOptions.circle;this.options.filterOptions.circle={x:l.y,y:l.x,radius:l.radius}}if(this.options.filterOptions&&this.options.filterOptions.polygon){var c=this.options.filterOptions.polygon;for(r=0;r<c.length;r++){var u=c[r];this.options.filterOptions.polygon[r]={x:u.y,y:u.x}}}}this.options.outputFormat=this.options.rawResponse?"":"xml"}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(79),c=r(80);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(t,e){var r={httpMethod:this.options.httpMethod,position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:"EPSG:4326",maximumResponses:this.options.maximumResponses};this.request=l.a.build(r),this.request?e.call(this,this.request):t.call(this,new i.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(t,e){if(this.response){var r={response:this.response,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};c.a.build(r)}else t.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},o.geoEPSG=["EPSG:4326"],e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(11),s=r(38),i={build:function(t){var e=o.a.getLogger("ReverseGeocodeRequestFactory");e.trace(["ReverseGeocodeRequestFactory::build()"]);var r=t||{},i=null,a=new s.a({position:r.position,returnFreeForm:r.returnFreeForm,filterOptions:r.filterOptions}),l=new n.a({srsName:r.srs,maximumResponses:r.maximumResponses});if(l.namespace=!0,l.setService(a),i=l.build(),"GET"===r.httpMethod){i="qxml="+encodeURIComponent(i).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}return e.trace(i),i}};e.a=i},function(t,e,r){"use strict";var o=r(1),n=r(2),s=r(6),i=r(81),a={build:function(t){var e=null;if(!t.response)return void t.onError.call(t.scope,new n.a({message:o.a.getMessage("SERVICE_RESPONSE_EMPTY"),type:n.a.TYPE_SRVERR,status:-1}));if(t.rawResponse)e=t.response;else{try{var r=new s.a({reader:i.a});if("string"==typeof t.response?r.setXMLString(t.response):r.setXMLDoc(t.response),!(e=r.parse()))throw new Error("L'analyse de la réponse du service !?")}catch(e){return e.status=200,void t.onError.call(t.scope,e)}if(e.exceptionReport)return void t.onError.call(t.scope,new n.a({message:o.a.getMessage("SERVICE_RESPONSE_EXCEPTION",e.exceptionReport),type:n.a.TYPE_SRVERR,status:200}));if(t.scope&&t.scope.options&&t.scope.options.srs&&"EPSG:4326"!==t.scope.options.srs){var a,l;if(e||e.locations||e.locations.length)for(var c=0;c<e.locations.length;c++)(a=e.locations[c])&&(l=a.position)&&(a.position={x:l.y,y:l.x})}}t.onSuccess.call(t.scope,e)}};e.a=a},function(t,e,r){"use strict";function o(t){if(t.attributes.length>0){for(var e={},r=t.attributes,o=0;o<r.length;o++){var n=r[o];e[n.nodeName]=n.nodeValue}return e}}function n(t,e){if(t.hasChildNodes())for(var r,o,s,i=t.childNodes,a=0;a<i.length;a++)if(r=i[a],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,s=r.prefix||p.DEFAULTPREFIX,p.READERS[s][o]){var l=p.READERS[s][o];l(r,e)}else n(r,e)}function s(t){var e,r="";return t.hasChildNodes()&&(e=t.firstChild,3===e.nodeType&&(r=e.nodeValue)),r}function i(t){if(t.attributes.length>0){var e=o(t);for(var r in e)if(e.hasOwnProperty(r)){if("version"===r&&e.version!==p.VERSION)return void console.log("[ReverseGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===r){if(e[r]!==p.NAMESPACES[p.DEFAULTPREFIX])return void console.log("[ReverseGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var n=r.split(":")[0],s=r.split(":")[1];if("xmlns"===n&&s&&p.NAMESPACES[s]&&p.NAMESPACES[s]!==e[r])return void console.log("[ReverseGeocodeResponseReader] geocode response "+r+" namespace is not the expected one");if("schemaLocation"===s&&p.SCHEMALOCATION!==e[r])return void console.log("[ReverseGeocodeResponseReader] geocode response schema location is not the expected one")}}}var a=r(1),l=r(2),c=r(14),u=r(40),p={};p.VERSION="1.2",p.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},p.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",p.DEFAULTPREFIX="xls",p.READERS={xls:{XLS:function(t){var e=new c.a;return i(t),n(t,e),e},ReverseGeocodedLocation:function(t,e){var r=new u.a;n(t,r),e&&Array.isArray(e.locations)&&e.locations.push(r)},Address:function(t,e){var r=t.getAttribute("countryCode");e&&r&&(e.type=r),n(t,e)},Building:function(t,e){var r=t.getAttribute("number");e&&e.hasOwnProperty("placeAttributes")&&(r?e.placeAttributes.number=r:t.getAttribute("buildingName")?e.placeAttributes.number=t.getAttribute("buildingName"):t.getAttribute("subdivision")&&(e.placeAttributes.number=t.getAttribute("subdivision")))},Street:function(t,e){"StreetAddress"===e.type?e.placeAttributes.street=s(t):"CadastralParcel"===e.type&&(e.placeAttributes.cadastralParcel=s(t))},Place:function(t,e){var r=t.getAttribute("type"),o=s(t);if(e&&e.hasOwnProperty("placeAttributes"))if("Municipality"===r)e.placeAttributes.municipality=o;else if("Bbox"===r){var n=o.split(";");4===n.length&&(e.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===r?e.placeAttributes.commune=o:"Departement"===r?e.placeAttributes.department=o:"INSEE"===r?e.placeAttributes.insee=o:"Qualite"===r?e.placeAttributes.quality=o:"Territoire"===r?e.placeAttributes.territory=o:"ID"===r?e.placeAttributes.ID=o:"ID_TR"===r?e.placeAttributes.IDTR=o:"Importance"===r?e.placeAttributes.importance=parseInt(o,10):"Nature"===r?e.placeAttributes.nature=o:"Numero"===r?e.placeAttributes.number=o:"Feuille"===r?e.placeAttributes.sheet=o:"Section"===r?e.placeAttributes.section=o:"CommuneAbsorbee"===r?e.placeAttributes.absorbedCity=o:"Arrondissement"===r?o&&(e.placeAttributes.arrondissement=o):"Type"===r?e.placeAttributes.origin=o:"Prefecture"===r?e.placeAttributes.prefecture=o:"InseeRegion"===r?e.placeAttributes.inseeRegion=o:"InseeDepartment"===r&&(e.placeAttributes.inseeDepartment=o)},PostalCode:function(t,e){e&&e.hasOwnProperty("placeAttributes")&&(e.placeAttributes.postalCode=s(t))},SearchCentreDistance:function(t,e){e&&(e.searchCenterDistance=parseFloat(t.getAttribute("value")))},Error:function(t){var e=t.getAttribute("message"),r=t.getAttribute("errorCode"),o=a.a.getMessage("SERVICE_RESPONSE_EXCEPTION","("+r+") : "+e);throw new l.a({message:o,type:l.a.TYPE_SRVERR})}},gml:{pos:function(t,e){var r=s(t);e&&r&&(e.position={x:parseFloat(r.split(" ")[0]),y:parseFloat(r.split(" ")[1])})}},xlsext:{ExtendedGeocodeMatchCode:function(t,e){e&&(e.matchType=s(t))}},ExceptionReport:function(t){var e={};if(t.hasChildNodes())for(var r,o=t.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(e.exceptionReport=p.READERS.Exception(r));return e},Exception:function(t){var e={},r=t.getAttribute("exceptionCode");r&&(e.exceptionCode=r);var o=t.firstChild;return o&&3===o.nodeType&&(e.exception=o.nodeValue),e}},p.read=function(t){if("XLS"===t.nodeName){var e=t.prefix;e||(e=p.DEFAULTPREFIX);return p.READERS[e][t.nodeName](t)}if("ExceptionReport"===t.nodeName){return p.READERS[t.nodeName](t)}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},e.a=p},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(a.a.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));if(this.CLASSNAME="AutoComplete",n.a.apply(this,arguments),this.logger=i.a.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]"),!t.text)throw new Error(a.a.getMessage("PARAM_MISSING","text"));this.options.text=t.text,t.filterOptions&&"object"==typeof t.filterOptions||(this.options.filterOptions=t.filterOptions={territory:[],type:["StreetAddress"]}),0===Object.keys(t.filterOptions).length&&(this.options.filterOptions={territory:[],type:["StreetAddress"]}),this.options.filterOptions.type=t.filterOptions.type||["StreetAddress"],this.options.filterOptions.territory=t.filterOptions.territory||[],this.options.maximumResponses=t.maximumResponses||10,"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}var n=r(3),s=r(83),i=r(0),a=r(1),l=r(4),c=r(2);o.prototype=Object.create(n.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(t,e){var r="";this.options.filterOptions.territory&&(r=this.options.filterOptions.territory.join(";"));var o="";this.options.filterOptions.type&&(o=this.options.filterOptions.type.join(",")),this.request=l.a.normalyzeParameters({text:encodeURIComponent(this.options.text),type:o,terr:r,maximumResponses:this.options.maximumResponses}),this.request?e.call(this,this.request):t.call(this,new c.a(a.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(t,e){if(this.response){var r={response:this.response,rawResponse:this.options.rawResponse,onSuccess:e,onError:t,scope:this};s.a.build(r)}else t.call(this,new c.a(a.a.getMessage("SERVICE_RESPONSE_EMPTY")))},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(41),a=r(42),l={build:function(t){var e=o.a.getLogger("AutoCompleteResponseFactory");e.trace(["AutoCompleteResponseFactory::build()"]);var r=null;if(!t.response)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(t.rawResponse)e.trace("analyze response : raw"),r=t.response;else{var l;if(l="string"==typeof t.response?JSON.parse(t.response):t.response){if(l.error)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",l.error.description),status:l.error.code,type:s.a.TYPE_SRVERR}));if(r=new i.a,!l.results||!Array.isArray(l.results))return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var c,u=0;u<l.results.length;u++){var p=l.results[u];c=new a.a,c&&(p&&"StreetAddress"===p.country?(c.street=p.street,c.type="StreetAddress"):p&&"PositionOfInterest"===p.country&&(c.poi=p.street,c.kind=p.kind,c.type="PositionOfInterest"),c.position&&(c.position.x=p.x,c.position.y=p.y),c.commune=p.city,c.fullText=p.fulltext,c.postalCode=p.zipcode,c.classification=p.classification),r.suggestedLocations.push(c)}if(!r.suggestedLocations.length)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!r)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:s.a.TYPE_UNKERR,status:-1}));if(r.exceptionReport)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",r.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}t.onSuccess.call(t.scope,r)}};e.a=l},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!t.startPoint)throw new Error(s.a.getMessage("PARAM_MISSING","startPoint"));if(null===t.startPoint.x)throw new Error(s.a.getMessage("PARAM_MISSING","startPoint.x"));if(null===t.startPoint.y)throw new Error(s.a.getMessage("PARAM_MISSING","startPoint.y"));if(!t.endPoint)throw new Error(s.a.getMessage("PARAM_MISSING","endPoint"));if(null===t.endPoint.x)throw new Error(s.a.getMessage("PARAM_MISSING","endPoint.x"));if(null===t.endPoint.y)throw new Error(s.a.getMessage("PARAM_MISSING","endPoint.y"));if(this.options.api="string"==typeof t.api?t.api.toUpperCase():"REST",this.options.outputFormat="string"==typeof t.outputFormat?t.outputFormat.toLowerCase():"json",this.options.startPoint=t.startPoint,this.options.endPoint=t.endPoint,this.options.viaPoints=t.viaPoints||null,this.options.exclusions=t.exclusions||null,this.options.routePreference=t.routePreference||"fastest",this.options.graph=t.graph||"Voiture",this.options.geometryInInstructions=t.geometryInInstructions||!1,this.options.provideBbox=t.provideBbox||!0,this.options.distanceUnit=t.distanceUnit||"km",this.options.expectedStartTime=null,this.options.srs=t.srs||"EPSG:4326",this.options.api="REST",this.logger.warn("FIXME : Surcharge option 'api' : REST"),"XHR"===this.options.protocol&&(this.options.httpMethod="GET",this.logger.trace("Surcharge option 'HttpMethod' : "+this.options.httpMethod)),!this.options.serverUrl){var e=l.a.Route.url(this.options.apiKey),r=null;switch(this.options.api){case"OLS":r=e.ols;break;case"REST":r=e["route-"+this.options.outputFormat];break;default:throw new Error(s.a.getMessage("PARAM_UNKNOWN","api"))}if(!r)throw new Error("Url by default not found !");this.options.serverUrl=r,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var c=this.options.serverUrl.substring(i+1);if(c&&c.length<5)switch(this.logger.trace("Serveur Extension URL : "+c),c.toLowerCase()){case"json":case"xml":this.options.outputFormat=c.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(5),c=r(85),u=r(93);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(t,e){var r={api:this.options.api,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,exclusions:this.options.exclusions,distanceUnit:this.options.distanceUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs};this.request=c.a.build(r),this.request?e.call(this,this.request):t.call(this,new i.a(s.a.getMessage("SERVICE_REQUEST_BUILD")))},o.prototype.analyzeResponse=function(t,e){if(this.response){var r={distanceUnit:this.options.distanceUnit,response:this.response,outputFormat:this.options.outputFormat,api:this.options.api,rawResponse:this.options.rawResponse,onError:t,onSuccess:e,scope:this};u.a.build(r)}else t.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(2),s=r(86),i=r(91),a={build:function(t){o.a.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var e=null,r=t||{},a=!(null===t.onError||"function"!=typeof t.onError),l=null;switch(t.api){case"REST":var c=new i.a(r);if(!c.processRequestString()){if(l="Error process request (rest) !",a)return void t.onError.call(t.scope,new n.a(l));throw new Error(l)}e=c.requestString;break;case"OLS":if(!(e=s.a.build(r))){if(l="Error process request (ols) !",a)return void t.onError.call(t.scope,new n.a(l));throw new Error(l)}break;default:if(l="Type of API is not supported by service (REST or OLS) !",a)return void t.onError.call(t.scope,new n.a(l));throw new Error(l)}return e}};e.a=a},function(t,e,r){"use strict";var o=r(0),n=r(11),s=r(87),i={build:function(t){o.a.getLogger("RouteRequestOLS").trace(["RouteRequestOLS::build()"]);var e=null,r={startPoint:t.startPoint,endPoint:t.endPoint,viaPoint:t.viaPoints,provideBoundingBox:t.provideBbox,avoidFeature:t.exclusions,expectedStartTime:t.expectedStartTime,distanceUnit:t.distanceUnit,graph:t.graph,provideGeometry:t.geometryInInstructions,routePreference:t.routePreference},i=new s.a(r),a=new n.a({srsName:t.srs,maximumResponses:t.maximumResponses});if(a.namespace=!0,a.setService(i),e=a.build(),"GET"===t.httpMethod){e="qxml="+encodeURIComponent(e).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}return e}};e.a=i},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur RouteService ()]"),!(this instanceof o))throw new TypeError("RouteService constructor cannot be called as a function.");this.CLASSNAME="RouteService",this.CLASSTYPE="RouteRequest",s.a.apply(this,arguments)}var n=r(0),s=r(12),i=r(88),a=r(90),l=r.n(a);o.prototype=Object.create(s.a.prototype,{}),o.prototype.constructor=o,o.prototype.addRequest=function(t){if("DetermineRouteRequest"!==t.CLASSNAME)throw new Error("Ce n'est pas un objet de type 'Route Request' !?");this.oRequest=t},o.prototype.addFilter=function(t){t instanceof l.a&&(this.oFilter=t)},o.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("RouteRequest"===this.CLASSTYPE){var t={distanceUnit:this.options.distanceUnit||null,provideGeometry:this.options.provideGeometry||null,provideBoundingBox:this.options.provideBoundingBox||null,route:{routePreference:this.options.routePreference||null,startPoint:this.options.startPoint,viaPoint:this.options.viaPoint||null,endPoint:this.options.endPoint,avoidFeature:this.options.avoidFeature||null,graph:this.options.graph||null,expectedStartTime:this.options.expectedStartTime||null}};this.oRequest=new i.a(t),this.oFilter&&this.oRequest.addFilter(this.oFilter)}}if(!this.oRequest)throw new Error("Type de requête indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur DetermineRouteRequest ()]"),!(this instanceof o))throw new TypeError("DetermineRouteRequest constructor cannot be called as a function.");this.options=t||{};for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);this.CLASSNAME="DetermineRouteRequest"}var n=r(0),s=r(89);o.prototype={strRequest:null,oRoutePlan:null,template:{determineRouteRequest:'<DetermineRouteRequest distanceUnit="__DISTANCEUNIT__">__ROUTEPLAN____ROUTEINSTRUCTIONREQUEST____ROUTEGEOMETRYREQUEST____ROUTEMAPREQUEST__</DetermineRouteRequest>',routeInstructionRequest:'<RouteInstructionsRequest provideGeometry="__PROVIDEGEOMETRY__" provideBoundingBox="__PROVIDEBBOX__" />',routeGeometryRequest:"<RouteGeometryRequest />",routeMapRequest:""},addRoute:function(t){t instanceof s.a&&(this.oRoutePlan=t)},constructor:o,toString:function(){var t="";if(t=this.template.determineRouteRequest,t=t.replace(/__DISTANCEUNIT__/g,this.options.distanceUnit||"KM"),!this.oRoutePlan){var e=this.options.route;if(this.oRoutePlan=new s.a(e),!this.oRoutePlan)throw new Error("La construction du calcul d'initineraire n'est pas correctement definie !?")}t=t.replace(/__ROUTEPLAN__/g,this.oRoutePlan.toString());var r=this.template.routeInstructionRequest;r=r.replace(/__PROVIDEGEOMETRY__/g,this.options.provideGeometry||!1),r=r.replace(/__PROVIDEBBOX__/g,this.options.provideBoundingBox||!1),t=t.replace(/__ROUTEINSTRUCTIONREQUEST__/g,r);var o=this.template.routeGeometryRequest;t=t.replace(/__ROUTEGEOMETRYREQUEST__/g,o);var n=this.template.routeMapRequest;return t=t.replace(/__ROUTEMAPREQUEST__/g,n),this.strRequest=t,this.strRequest}},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger("RoutePlan"),this.logger.trace("[Constructeur RoutePlan ()]"),!(this instanceof o))throw new TypeError("RoutePlan constructor cannot be called as a function.");if(this.options=t||{},!t.startPoint)throw new Error("l'option 'startPoint' n'est pas renseignée !");if(!t.endPoint)throw new Error("l'option 'endPoint' n'est pas renseignée !");for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])}var n=r(0);o.prototype={constructor:o,requestString:null,template:{routePlan:"<RoutePlan>__ROUTEPREFERENCE____GRAPH____WAYPOINTLIST____AVOIDLIST__</RoutePlan>",routePreference:"<RoutePreference>__VALUEROUTEPREFERENCE__</RoutePreference>",graph:'<xlsext:graphName xmlns:xlsext="http://www.opengis.net/xlsext" name="__VALUEGRAPH__"/>',wayPointList:{container:"<WayPointList>__STARTPOINT____VIAPOINT____ENDPOINT__</WayPointList>",point:'<Position><gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point></Position>',startPoint:"<StartPoint>__POINT__</StartPoint>",endPoint:"<EndPoint>__POINT__</EndPoint>",viaPoint:"<ViaPoint>__POINT__</ViaPoint>"},avoidList:{container:"<AvoidList>__AVOIDFEATURE__</AvoidList>",avoidFeature:"<AvoidFeature>__VALUEAVOIDFEATURE__</AvoidFeature>"}},toString:function(){var t="";if(t=this.template.routePlan,this.options.routePreference){var e=this.template.routePreference;e=e.replace(/__VALUEROUTEPREFERENCE__/,this.options.routePreference),t=t.replace(/__ROUTEPREFERENCE__/g,e)}if(t=t.replace(/__ROUTEPREFERENCE__/g,""),this.options.avoidFeature){for(var r=this.template.avoidList.container,o=[],n=0;n<this.options.avoidFeature.length;n++){var s=this.template.avoidList.avoidFeature;s=s.replace(/__VALUEAVOIDFEATURE__/,this.options.avoidFeature[n]),o.push(s)}r=r.replace(/__AVOIDFEATURE__/,o.join("\n")),t=t.replace(/__AVOIDLIST__/g,r)}if(t=t.replace(/__AVOIDLIST__/g,""),this.options.graph){var i=this.template.graph;i=i.replace(/__VALUEGRAPH__/,this.options.graph),t=t.replace(/__GRAPH__/g,i)}t=t.replace(/__GRAPH__/g,"");var a=this.template.wayPointList.container,l="";if(l=this.template.wayPointList.point,l=l.replace(/__X__/,this.options.startPoint.x),l=l.replace(/__Y__/,this.options.startPoint.y),a=a.replace(/__STARTPOINT__/,this.template.wayPointList.startPoint.replace(/__POINT__/,l)),l=this.template.wayPointList.point,l=l.replace(/__X__/,this.options.endPoint.x),l=l.replace(/__Y__/,this.options.endPoint.y),a=a.replace(/__ENDPOINT__/,this.template.wayPointList.endPoint.replace(/__POINT__/,l)),this.options.viaPoint){for(var c=[],u=0;u<this.options.viaPoint.length;u++){var p=this.options.viaPoint[u];l=this.template.wayPointList.point,l=l.replace(/__X__/,p.x),l=l.replace(/__Y__/,p.y),c.push(l)}a=a.replace(/__VIAPOINT__/,this.template.wayPointList.viaPoint.replace(/__POINT__/,c.join("\n")))}else a=a.replace(/__VIAPOINT__/,"");return t=t.replace(/__WAYPOINTLIST__/g,a),this.requestString=t,this.requestString}},e.a=o},function(t,e){},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof o))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!t)throw new Error(s.a.getMessage("PARAM_EMPTY","options"));this.settings=t}var n=r(0),s=r(1),i=r(92);o.prototype={requestString:null,constructor:o,processRequestString:function(){this.logger.warn("FIXME : PROTOTYPE !");for(var t=new i.a(this.settings),e=t.getParams(),r="",o=0;o<e.length;o++){var n=e[o];r&&(r+="&"),r+=n.k+"="+n.v}return this.logger.trace(r),this.requestString=r,this.requestString}},e.a=o},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("RouteParamREST constructor cannot be called as a function.");if(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=t||{},this.origin=this.options.startPoint.x+","+this.options.startPoint.y,this.destination=this.options.endPoint.x+","+this.options.endPoint.y,this.waypoints=this.options.viaPoints||null,this.startDateTime=this.options.expectedStartTime||null,this.graphName=this.options.graph,this.srs=this.options.srs,this.exclusions=this.options.exclusions,this.method="TIME",this.options.routePreference){switch(this.options.routePreference){case"fastest":this.method="TIME";break;case"shortest":this.method="DISTANCE";break;default:this.logger.warn("Par defaut, on prend l'itinéraire le plus rapide !"),this.method="TIME"}}this.format=this.options.geometryInInstructions?"STANDARDEXT":"STANDARD",this.tolerance=10,this.profileId=null,this.profileName=null}var n=r(0);o.CLASSNAME="RouteParamREST",o.prototype={constructor:o,getWaypoints:function(){if(this.waypoints){for(var t=[],e=0;e<this.waypoints.length;e++){var r=this.waypoints[e];t.push(r.x+","+r.y)}return t.join(";")}},getExclusions:function(){return this.exclusions.join(";")}},o.prototype.getParams=function(){var t=[];return t.push({k:"origin",v:this.origin}),t.push({k:"destination",v:this.destination}),t.push({k:"method",v:this.method}),this.waypoints&&t.push({k:"waypoints",v:this.getWaypoints()}),this.startDateTime&&t.push({k:"startDateTime",v:this.startDateTime}),this.graphName&&t.push({k:"graphName",v:this.graphName}),this.exclusions&&t.push({k:"exclusions",v:this.getExclusions()}),this.srs&&t.push({k:"srs",v:this.srs}),this.format&&t.push({k:"format",v:this.format}),t},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(8),l=r(94),c=r(95),u=r(16),p=r(17),h={build:function(t){var e=o.a.getLogger("RouteResponseFactory");e.trace("RouteResponseFactory::build()");var r=null;if(!t.response)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(t.rawResponse)e.trace("analyze response : raw"),r=t.response;else{switch(t.outputFormat){case"xml":e.trace("analyze response : xml");var h="REST"===t.api?l.a:c.a;try{var f=new i.a({reader:h});if("string"==typeof t.response?f.setXMLString(t.response):f.setXMLDoc(t.response),!(r=f.parse()))throw new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT","xml"))}catch(e){return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_ANALYSE",t.response)))}break;case"json":e.trace("analyze response : json");var g;if(g="string"==typeof t.response?JSON.parse(t.response):t.response,g.message)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",g.message)));if(g){var d=[],m=[],E=[];if(r=new u.a,r.hasOwnProperty("totalTime")&&(r.totalTime=parseFloat(g.durationSeconds)),r.hasOwnProperty("totalDistance")&&(r.totalDistance="m"===t.distanceUnit?g.distanceMeters:g.distance),r.hasOwnProperty("bbox")){var _=g.bounds.split(/[,;]/);r.bbox.left=parseFloat(_[0]),r.bbox.bottom=parseFloat(_[1]),r.bbox.right=parseFloat(_[2]),r.bbox.top=parseFloat(_[3])}var v=function(t){r.routeGeometry=t},y=function(e){console.log(e),t.onError.call(t.scope,new s.a(n.a.getMessage("PARAM_FORMAT",["geometryWkt"])))};if(r.hasOwnProperty("routeGeometry")){var R=g.geometryWkt||g.simplifiedWkt;if(R&&(a.a.toJson(R,v,y),!r.routeGeometry))return}if(r.hasOwnProperty("routeInstructions")){var S,w=g.legs;if(Array.isArray(w)&&w.length)for(S=0;S<w.length;S++)d.push(w[S]);if(Array.isArray(d)&&d.length)for(S=0;S<d.length;S++)m.push(d[S].steps);if(Array.isArray(m)&&m.length)for(S=0;S<m.length;S++)E=E.concat(m[S]);E.forEach(function(e){r.routeInstructions.push(new p.a),r.routeInstructions[r.routeInstructions.length-1].duration=e.durationSeconds,r.routeInstructions[r.routeInstructions.length-1].distance="m"===t.distanceUnit?e.distanceMeters:e.distance,r.routeInstructions[r.routeInstructions.length-1].code=e.navInstruction;for(var o=[],n=0;n<e.points.length;n++){var s=e.points[n].split(",");s&&o.push(s)}switch(o&&0!==o.length?r.routeInstructions[r.routeInstructions.length-1].geometry={coordinates:o,type:"LineString"}:r.routeInstructions[r.routeInstructions.length-1].geometry=null,"Valeur non renseignée"===e.name&&(e.name=""),e.navInstruction){case"F":e.name?r.routeInstructions[r.routeInstructions.length-1].instruction="Tout droit "+e.name:r.routeInstructions[r.routeInstructions.length-1].instruction="Continuer tout droit ";break;case"B":r.routeInstructions[r.routeInstructions.length-1].instruction="Demi-tour "+e.name;break;case"L":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner à gauche "+e.name;break;case"R":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner à droite "+e.name;break;case"BL":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner très à gauche "+e.name;break;case"BR":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner très à droite "+e.name;break;case"FL":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner légèrement à gauche "+e.name;break;case"FR":r.routeInstructions[r.routeInstructions.length-1].instruction="Tourner légèrement à droite "+e.name;break;case"round_about_entry":r.routeInstructions[r.routeInstructions.length-1].instruction="Entrée rond-point "+e.name;break;case"round_about_exit":r.routeInstructions[r.routeInstructions.length-1].instruction="Sortie rond-point "+e.name;break;case null:r.routeInstructions[r.routeInstructions.length-1].instruction="Prendre tout droit "+e.name;break;default:r.routeInstructions[r.routeInstructions.length-1].instruction="?"+e.navInstruction+"? "+e.name}})}}if(!r)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_ANALYSE","json")));break;default:return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(r&&r.exceptionReport)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}t.onSuccess.call(t.scope,r)}};e.a=h},function(t,e,r){"use strict";function o(t){var e,r="";return t.hasChildNodes()&&(e=t.firstChild)&&3===e.nodeType&&(r=e.nodeValue),r}function n(t,e){if(t.hasChildNodes())for(var r,o,s=t.childNodes,i=0;i<s.length;i++)if(r=s[i],1===r.nodeType)if(o=r.localName||r.baseName||r.nodeName,u.READERS[o]){var a=u.READERS[o];a(r,e)}else n(r,e)}var s=r(1),i=r(8),a=r(2),l=r(16),c=r(17),u={};u.READERS={routeResult:function(t){var e=new l.a;if(n(t,e),"error"===e.status){var r=s.a.getMessage("SERVICE_RESPONSE_EXCEPTION",e.message);throw new a.a({message:r,type:a.a.TYPE_SRVERR})}return e},status:function(t,e){var r=o(t);"ERROR"!==r&&"error"!==r||e&&(e.status="error")},message:function(t,e){e&&(e.message=o(t))},distance:function(t,e){e&&(e.totalDistance=o(t))},durationSeconds:function(t,e){e&&(e.totalTime=parseFloat(o(t)))},bounds:function(t,e){if(e&&e.bbox){var r=o(t).split(/[,;]/);e.bbox.left=parseFloat(r[0]),e.bbox.bottom=parseFloat(r[1]),e.bbox.right=parseFloat(r[2]),e.bbox.top=parseFloat(r[3])}},geometryWkt:function(t,e){if(e){var r=t.innerHTML,o=function(t){e.routeGeometry=t},n=function(){var t=s.a.getMessage("PARAM_FORMAT",["geometryWkt"]);throw new Error(t)};i.a.toJson(r,o,n)}},step:function(t,e){var r,n=new c.a;if(t.hasChildNodes)for(var s,i,a=t.childNodes,l=0;l<a.length;l++)s=a[l],1===s.nodeType&&(i=s.localName||s.baseName||s.nodeName,"durationSeconds"===i?n.duration=o(s):"distance"===i?n.distance=o(s):"navInstruction"===i?n.code=o(s):"name"===i&&(r=o(s)));if(n.code)switch(n.code){case"F":n.instruction="Valeur non renseignée"!==r?"Tout droit "+r:"Continuer tout droit ";break;case"B":n.instruction="Demi-tour "+r;break;case"L":n.instruction="Tourner à gauche "+r;break;case"R":n.instruction="Tourner à droite "+r;break;case"BL":n.instruction="Tourner très à gauche "+r;break;case"BR":n.instruction="Tourner très à droite "+r;break;case"FL":n.instruction="Tourner légèrement à gauche "+r;break;case"FR":n.instruction="Tourner légèrement à droite "+r;break;case"round_about_entry":n.instruction="Entrée rond-point "+r;break;case"round_about_exit":n.instruction="Sortie rond-point "+r;break;case null:n.instruction="Prendre "+r;break;default:n.instruction="?"+n.code+"? "+r}Array.isArray(e.routeInstructions)&&e.routeInstructions.push(n)}},u.read=function(t){if("routeResult"===t.nodeName)return u.READERS.routeResult(t);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},e.a=u},function(t,e,r){"use strict";var o=r(0),n={};n.READERS={},n.read=function(t){o.a.getLogger("RouteResponseOLSReader").error("not yet implemented !")},e.a=n},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError(s.a.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",a.a.apply(this,arguments),this.logger=n.a.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!t.position)throw new Error(s.a.getMessage("PARAM_MISSING","position"));if(null===t.position.x)throw new Error(s.a.getMessage("PARAM_MISSING","position.x"));if(null===t.position.y)throw new Error(s.a.getMessage("PARAM_MISSING","position.y"));if(!t.time&&!t.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!t.time&&t.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),t.time&&!t.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.exclusions=t.exclusions||null,this.options.graph=t.graph||"Voiture",this.options.reverse=t.reverse||!1,this.options.smoothing=t.smoothing||!1,this.options.holes=t.holes||!1,this.options.srs=t.srs||"EPSG:4326",this.options.outputFormat="string"==typeof t.outputFormat?t.outputFormat.toLowerCase():"json",!this.options.serverUrl){var e=l.a.ProcessIsoCurve.url(this.options.apiKey),r=e["iso-"+this.options.outputFormat];if(!r)throw new Error("Url by default not found !");this.options.serverUrl=r,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var i=this.options.serverUrl.lastIndexOf(".");if(-1!==i){var c=this.options.serverUrl.substring(i+1);if(c&&c.length<5)switch(this.logger.trace("Serveur Extension URL : "+c),c.toLowerCase()){case"json":case"xml":this.options.outputFormat=c.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}var n=r(0),s=r(1),i=r(2),a=r(3),l=r(5),c=r(97),u=r(99);o.prototype=Object.create(a.a.prototype,{}),o.prototype.constructor=o,o.prototype.buildRequest=function(t,e){try{var r=new c.a(this.options);if(!r.processRequestString())throw new Error(s.a.getMessage("SERVICE_REQUEST_BUILD"));this.request=r.requestString}catch(e){return void t.call(this,new i.a(e.message))}e.call(this,this.request)},o.prototype.analyzeResponse=function(t,e){if(this.response){var r={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:e,onError:t,scope:this};u.a.build(r)}else t.call(this,new i.a(s.a.getMessage("SERVICE_RESPONSE_EMPTY")))},e.a=o},function(t,e,r){"use strict";function o(t){if(this.logger=n.a.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof o))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!t)throw new Error(s.a.getMessage("PARAM_EMPTY","options"));this.settings=t,this.mode=this.settings.httpMethod||"GET"}var n=r(0),s=r(1),i=r(98);o.prototype={requestString:null,constructor:o,template:{container:'<?xml version="1.0" encoding="UTF-8"?>\n<isochroneRequest>\n__ID__\t<location>\n\t\t<x>__X__</x>\n\t\t<y>__Y__</y>\n\t</location>\n\t<srs>__SRS__</srs>\n\t<graphName>__GRAPHNAME__</graphName>\n__PROFIL____EXCLUSIONS__\t<method>__METHOD__</method>\n__TIME____DISTANCE__\t<reverse>__REVERSE__</reverse>\n\t<smoothing>__SMOOTHING__</smoothing>\n\t<holes>__HOLES__</holes>\n</isochroneRequest>',id:"\t<id>__IDVALUE__</id>\n",profil:"\t<profileId>__PROFILID__</profileId>\n\t<profileName>__PROFILNAME__</profileName>\n",exclusions:{container:"\t<exclusions>\n__EXCLUSIONFEATURE__\n\t</exclusions>\n",feature:"\t\t<exclusion>__EXCLUSIONVALUE__</exclusion>"},time:"\t<time>__TIMEVALUE__</time>\n",distance:"\t<distance>__DISTANCEVALUE__</distance>\n"},processRequestString:function(){var t="",e=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var r=new i.a(this.settings),o=r.getParams();for(e=0;e<o.length;e++){var n=o[e];t&&(t+="&"),t+=n.k+"="+n.v}break;case"POST":if(this.logger.trace("Process POST Request"),t=this.template.container,t=t.replace(/__ID__/g,""),t=t.replace(/__PROFIL__/g,""),t=t.replace(/__X__/g,this.settings.position.x),t=t.replace(/__Y__/g,this.settings.position.y),t=t.replace(/__GRAPHNAME__/g,this.settings.graph),t=t.replace(/__SRS__/g,this.settings.srs),t=t.replace(/__SMOOTHING__/g,this.settings.smoothing),t=t.replace(/__HOLES__/g,this.settings.holes),t=t.replace(/__REVERSE__/g,this.settings.reverse),this.settings.exclusions){var s=this.template.exclusions.container,a=[];for(e=0;e<this.settings.exclusions.length;e++){var l=this.template.exclusions.feature;l=l.replace(/__EXCLUSIONVALUE__/,this.settings.exclusions[e]),a.push(l)}s=s.replace(/__EXCLUSIONFEATURE__/,a.join("\n")),t=t.replace(/__EXCLUSIONS__/g,s)}if(t=t.replace(/__EXCLUSIONS__/g,""),this.settings.distance){var c=this.template.distance;c=c.replace(/__DISTANCEVALUE__/g,this.settings.distance),t=t.replace(/__DISTANCE__/g,c),t=t.replace(/__METHOD__/g,"distance")}if(t=t.replace(/__DISTANCE__/g,""),this.settings.time){var u=this.template.time;u=u.replace(/__TIMEVALUE__/g,this.settings.time),t=t.replace(/__TIME__/g,u),t=t.replace(/__METHOD__/g,"time")}t=t.replace(/__TIME__/g,"");break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(t),this.requestString=t,this.requestString}},e.a=o},function(t,e,r){"use strict";function o(t){if(!(this instanceof o))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");switch(this.logger=n.a.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=t||{},this.id=this.options.id,this.location=this.options.position,this.srs=this.options.srs,this.graphName=this.options.graph,this.profileId=this.options.profileId||null,this.profileName=this.options.profileName||null,this.exclusions=this.options.exclusions,this.reverse=this.options.reverse,this.smoothing=this.options.smoothing,this.holes=this.options.holes,this.options.method){case"time":this.method="time",this.time=this.options.time;break;case"distance":this.method="distance",this.distance=this.options.distance;break;default:this.logger.warn("Par defaut, on calcule un isochrone !"),this.method="time"}}var n=r(0);o.CLASSNAME="ProcessIsoCurveParam",o.prototype={constructor:o,getLocation:function(){return this.location.x+","+this.location.y},getExclusions:function(){return this.exclusions.join(";")}},o.prototype.getParams=function(){var t=[];return t.push({k:"location",v:this.getLocation()}),t.push({k:"smoothing",v:this.smoothing}),t.push({k:"holes",v:this.holes}),t.push({k:"reverse",v:this.reverse}),t.push({k:"method",v:this.method}),this.time&&t.push({k:"time",v:this.time}),this.distance&&t.push({k:"distance",v:this.distance}),t.push({k:"graphName",v:this.graphName}),this.exclusions&&t.push({k:"exclusions",v:this.getExclusions()}),this.srs&&t.push({k:"srs",v:this.srs}),t},e.a=o},function(t,e,r){"use strict";var o=r(0),n=r(1),s=r(2),i=r(6),a=r(8),l=r(100),c=r(18),u={build:function(t){var e=o.a.getLogger("ProcessIsoCurveResponseFactory");e.trace(["ProcessIsoCurveResponseFactory::build()"]);var r=null;if(!t.response)return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EMPTY")));if(t.rawResponse)e.trace("analyze response : raw"),r=t.response;else{switch(t.outputFormat){case"xml":e.trace("analyze response : xml");try{var u=new i.a({reader:l.a});if("string"==typeof t.response?u.setXMLString(t.response):u.setXMLDoc(t.response),!(r=u.parse()))throw new Error(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(e){var p=e.message;return p+="\n (raw response service : '"+t.response+"')",void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",p),status:200,type:s.a.TYPE_SRVERR}))}break;case"json":e.trace("analyze response : json");var h;if(h="string"==typeof t.response?JSON.parse(t.response):t.response,"OK"===h.status||"ok"===h.status){if(!(r=new c.a))return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_ANALYSE",t.response)));r.time=h.time,r.distance=h.distance,r.message=h.message,r.id=h.id,r.srs=h.srs;var f=function(t){r.geometry=t},g=function(){t.onError.call(t.scope,new s.a({message:n.a.getMessage("PARAM_FORMAT","wktGeometry")}))};if(r.hasOwnProperty("geometry")&&(a.a.toJson(h.wktGeometry,f,g),!r.geometry))return;var d=h.location.split(",");r.location&&(r.location.x=d[0],r.location.y=d[1])}else if("ERROR"===h.status||"error"===h.status){var m=h.message;return m+="\n (raw response service : '"+h+"')",void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",m)))}break;default:return void t.onError.call(t.scope,new s.a(n.a.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(r&&r.exceptionReport)return void t.onError.call(t.scope,new s.a({message:n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",r.exceptionReport),type:s.a.TYPE_SRVERR,status:200}))}t.onSuccess.call(t.scope,r)}};e.a=u},function(t,e,r){"use strict";function o(t){var e,r="";return t.hasChildNodes()&&(e=t.firstChild)&&3===e.nodeType&&(r=e.nodeValue),r}var n=r(1),s=r(8),i=r(2),a=r(18),l={};l.READERS={isochronResult:function(t){var e=new a.a;if(t.hasChildNodes())for(var r,o=t.childNodes,s=0;s<o.length;s++)r=o[s],l.READERS[r.nodeName]&&l.READERS[r.nodeName](r,e);if("error"===e.status){var c=n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",e.message);throw new i.a({message:c,type:i.a.TYPE_SRVERR})}return e},message:function(t,e){e&&(e.message=o(t))},status:function(t,e){var r=o(t);"ERROR"!==r&&"error"!==r||e&&(e.status="error")},id:function(t,e){e&&(e.id=o(t))},location:function(t,e){var r=o(t);e&&e.location&&(e.location.x=parseFloat(r.split(",")[0]),e.location.y=parseFloat(r.split(",")[1]))},srs:function(t,e){e&&(e.srs=o(t))},distance:function(t,e){e&&(e.distance=parseFloat(o(t)))},time:function(t,e){e&&(e.time=parseFloat(o(t)))},wktGeometry:function(t,e){if(e){var r=t.innerHTML,o=function(t){e.geometry=t},i=function(){var t=n.a.getMessage("PARAM_FORMAT",["wktGeometry"]);throw new Error(t)};e.hasOwnProperty("geometry")&&s.a.toJson(r,o,i)}},serviceResult:function(t){var e={};if(t.hasChildNodes())for(var r,o=t.childNodes,n=0;n<o.length;n++)r=o[n],l.READERS[r.nodeName]&&l.READERS[r.nodeName](r,e);return e},ExceptionReport:function(t){var e={};if(t.hasChildNodes())for(var r,o=t.childNodes,n=0;n<o.length;n++)r=o[n],"Exception"===r.nodeName&&(e.exceptionReport=l.READERS.Exception(r));return e},Exception:function(t){var e={},r=t.getAttribute("exceptionCode");r&&(e.exceptionCode=r);var o=t.firstChild;return o&&3===o.nodeType&&(e.exception=o.nodeValue),e}},l.read=function(t){var e;if("isochronResult"===t.nodeName||"isochroneResult"===t.nodeName||"IsochroneResult"===t.nodeName)return e=l.READERS.isochronResult(t);if("ExceptionReport"===t.nodeName)return e=l.READERS[t.nodeName](t);if(l.READERS[t.nodeName]){if(e=l.READERS[t.nodeName](t),"error"===e.status){var r=n.a.getMessage("SERVICE_RESPONSE_EXCEPTION",e.message);throw new i.a({message:r,type:i.a.TYPE_SRVERR})}return e}throw new i.a({message:n.a.getMessage("SERVICE_RESPONSE_ANALYSE",t.nodeName),type:i.a.TYPE_UNKERR})},e.a=l}]).default});